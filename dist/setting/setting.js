System.register(["jimu-core","jimu-ui","jimu-ui/basic/color-picker","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-theme","jimu-arcgis"],(function(e,t){var r={},o={},n={},a={},l={},i={},s={};return{setters:[function(e){r.DataSourceTypes=e.DataSourceTypes,r.Immutable=e.Immutable,r.React=e.React,r.ReactRedux=e.ReactRedux,r.css=e.css,r.hooks=e.hooks,r.jsx=e.jsx},function(e){o.Alert=e.Alert,o.Button=e.Button,o.CollapsablePanel=e.CollapsablePanel,o.NumericInput=e.NumericInput,o.SVG=e.SVG,o.Slider=e.Slider,o.Switch=e.Switch,o.TextInput=e.TextInput,o.Tooltip=e.Tooltip,o.defaultMessages=e.defaultMessages},function(e){n.ColorPicker=e.ColorPicker},function(e){a.MapWidgetSelector=e.MapWidgetSelector,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection},function(e){l.DataSourceSelector=e.DataSourceSelector},function(e){i.useTheme=e.useTheme},function(e){s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={844:(e,t,r)=>{"use strict";r.d(t,{createPropertySelectors:()=>i,propertyActions:()=>a});var o=r(7390),n=r(7507);Object.values(n._);const a={setError:(e,t)=>({type:n._.SET_ERROR,error:e,widgetId:t}),clearError:e=>({type:n._.CLEAR_ERROR,widgetId:e}),setSelectedProperties:(e,t)=>({type:n._.SET_SELECTED_PROPERTIES,properties:e,widgetId:t}),clearAll:e=>({type:n._.CLEAR_ALL,widgetId:e}),setQueryInFlight:(e,t)=>({type:n._.SET_QUERY_IN_FLIGHT,inFlight:e,widgetId:t}),setRawResults:(e,t)=>({type:n._.SET_RAW_RESULTS,results:e,widgetId:t}),removeWidgetState:e=>({type:n._.REMOVE_WIDGET_STATE,widgetId:e})},l=(()=>{const e=o;return"function"==typeof e.default?e.default:"function"==typeof e.Immutable?e.Immutable:e=>e})(),i=(l({byId:{}}),e=>{const t=e=>{if(!e||"object"!=typeof e)return!1;return"function"==typeof e.asMutable},r=e=>{const r=(e=>{var r;if(!e)return[];if(Array.isArray(e))return e.slice();if(t(e)){const t=null===(r=e.asMutable)||void 0===r?void 0:r.call(e,{deep:!0});return Array.isArray(t)?t.slice():[]}return[]})(e);return r.filter((e=>!!e&&"object"==typeof e))},o=t=>{var r,o;const n=null===(o=null===(r=null==t?void 0:t["property-state"])||void 0===r?void 0:r.byId)||void 0===o?void 0:o[e];return null!=n?n:null};return{selectSlice:o,selectError:e=>{var t,r;return null!==(r=null===(t=o(e))||void 0===t?void 0:t.error)&&void 0!==r?r:null},selectSelectedProperties:e=>{var t;return r(null===(t=o(e))||void 0===t?void 0:t.selectedProperties)},selectIsQueryInFlight:e=>{var t,r;return null!==(r=null===(t=o(e))||void 0===t?void 0:t.isQueryInFlight)&&void 0!==r&&r},selectRawResults:e=>{var r;return(e=>{var r;if(!e||"object"!=typeof e)return null;if(t(e)){const t=null===(r=e.asMutable)||void 0===r?void 0:r.call(e,{deep:!0});return t&&"object"==typeof t?t:null}return e})(null===(r=o(e))||void 0===r?void 0:r.rawPropertyResults)}}})},1528:(e,t,r)=>{"use strict";r.d(t,{Lt:()=>o,jf:()=>n,kf:()=>a});const o=e=>{const t=e.fbwebbBaseUrl,r=e.fbwebbUser,o=e.fbwebbPassword,n=e.fbwebbDatabase;return Boolean(t&&r&&o&&n)};function n(e){return e.valid&&"data"in e}function a(e){return!e.valid}},1601:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik04Ljc0NTQ4IDhMMTQuODQ1NiAxNC4xMDAxQzE1LjA1MTUgMTQuMzA2IDE1LjA1MTUgMTQuNjM5NyAxNC44NDU2IDE0Ljg0NTZDMTQuNjM5NyAxNS4wNTE1IDE0LjMwNiAxNS4wNTE1IDE0LjEwMDEgMTQuODQ1Nkw4IDguNzQ1NDhMMS44OTk4NyAxNC44NDU2QzEuNjk0MDEgMTUuMDUxNSAxLjM2MDI1IDE1LjA1MTUgMS4xNTQzOSAxNC44NDU2QzAuOTQ4NTM2IDE0LjYzOTcgMC45NDg1MzYgMTQuMzA2IDEuMTU0MzkgMTQuMTAwMUw3LjI1NDUyIDhMMS4xNTQzOSAxLjg5OTg3QzAuOTQ4NTM1IDEuNjk0MDEgMC45NDg1MzUgMS4zNjAyNSAxLjE1NDM5IDEuMTU0MzlDMS4zNjAyNSAwLjk0ODUzNiAxLjY5NDAxIDAuOTQ4NTM2IDEuODk5ODcgMS4xNTQzOUw4IDcuMjU0NTJMMTQuMTAwMSAxLjE1NDM5QzE0LjMwNiAwLjk0ODUzNSAxNC42Mzk3IDAuOTQ4NTM1IDE0Ljg0NTYgMS4xNTQzOUMxNS4wNTE1IDEuMzYwMjUgMTUuMDUxNSAxLjY5NDAxIDE0Ljg0NTYgMS44OTk4N0w4Ljc0NTQ4IDhaIiBmaWxsPSJibGFjayIvPg0KPC9zdmc+DQo="},1888:e=>{"use strict";e.exports=i},2686:e=>{"use strict";e.exports=s},2796:(e,t,r)=>{"use strict";r.d(t,{Dj:()=>i,Nb:()=>a,Ye:()=>l,nV:()=>o,pd:()=>s,qC:()=>n});const o=3,n=3,a=20,l=12,i={textColor:"#000000",backgroundColor:"#ffffffe0",fontFamily:"sans-serif",fontSize:10,fontWeight:"normal",verticalAlignment:"top",horizontalAlignment:"center",yoffset:28,xoffset:0,lineWidth:192,lineHeight:1,kerning:!0},s=/^#?([0-9a-fA-F]{6})$/},3089:e=>{"use strict";e.exports=l},4321:e=>{"use strict";e.exports=o},4337:e=>{"use strict";e.exports=n},6250:(e,t,r)=>{"use strict";r.d(t,{PM:()=>m,XW:()=>I,nS:()=>S});var o=r(2686),n=r(1528),a=(r(2796),r(8491)),l=function(e,t,r,o){return new(r||(r=Promise))((function(n,a){function l(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,i)}s((o=o.apply(e,t||[])).next())}))};const i=/\/(mapserver|featureserver)\/\d+(?:\/query)?$/i,s=[/^10\.\d{1,3}\.\d{1,3}\.\d{1,3}$/u,/^172\.(1[6-9]|2\d|3[0-1])\.\d{1,3}\.\d{1,3}$/u,/^192\.168\.\d{1,3}\.\d{1,3}$/u],u=new Set(["localhost","127.0.0.1","[::1]"]);let c=null,p=null;const d=new Map,f=(new Map,e=>e.trim().toLowerCase()),g=e=>e?{signal:e}:void 0,h=e=>e||void 0,b=(e,t,r)=>({valid:!1,error:{type:e,message:t},failureReason:r}),y=(e,t,r)=>e?{valid:!0,data:{dataSource:e}}:b("VALIDATION_ERROR",r("errorNoDataAvailable"),`${t}_data_source_missing`),w=(e,t,r,o)=>{const n=(e=>{var t,r;if(!e)return null;if("string"==typeof e.url&&e.url)return e.url;const o=null===(t=e.getLayerDefinition)||void 0===t?void 0:t.call(e);if(o&&"object"==typeof o){const e=o.url;if(e)return e}const n=null===(r=e.getDataSourceJson)||void 0===r?void 0:r.call(e);if(n&&"object"==typeof n){const e=n.url;if(e)return e}return null})(e);return n?v(n,r)?{valid:!0,data:{url:n}}:b("VALIDATION_ERROR",o("errorHostNotAllowed"),`${t}_disallowed_host`):b("VALIDATION_ERROR",o("errorNoDataAvailable"),`${t}_missing_url`)},v=(e,t)=>{if(!e||"string"!=typeof e)return!1;let r;try{r=new URL(e)}catch(e){return!1}if("https:"!==r.protocol)return!1;if(""!==(o=r.port)&&"443"!==o)return!1;var o;const n=r.hostname;if((e=>{const t=(e=>e.startsWith("[")&&e.endsWith("]")?e.slice(1,-1):e)(e.toLowerCase());return!!u.has(t)||"::1"===t||!!/^\d{1,3}(\.\d{1,3}){3}$/u.test(t)&&s.some((e=>e.test(t)))})(n))return!1;if(!((e,t)=>{if(!t||0===t.length)return!0;const r=f(e);return t.some((e=>{const t=f(e);return r===t||r.endsWith(`.${t}`)}))})(n,t))return!1;const a=r.pathname.replace(/\/+/g,"/").toLowerCase();return!!i.test(a)},m=e=>{const{propertyDsId:t,ownerDsId:r,dsManager:o,allowedHosts:a,translate:l}=e;if(!t||!r)return b("VALIDATION_ERROR",l("errorNoDataAvailable"),"missing_data_sources");if(!o)return b("QUERY_ERROR",l("errorQueryFailed"),"no_data_source_manager");const i=o.getDataSource(t),s=o.getDataSource(r),u=y(i,"property",l);if((0,n.kf)(u))return{valid:!1,error:u.error,failureReason:u.failureReason};const c=y(s,"owner",l);if((0,n.kf)(c))return{valid:!1,error:c.error,failureReason:c.failureReason};const p=w(u.data.dataSource,"property",a,l);if((0,n.kf)(p))return{valid:!1,error:p.error,failureReason:p.failureReason};const d=w(c.data.dataSource,"owner",a,l);return(0,n.kf)(d)?{valid:!1,error:d.error,failureReason:d.failureReason}:{valid:!0,data:{manager:o}}},I=(e,t,r,n)=>l(void 0,void 0,void 0,(function*(){try{a.abortHelpers.throwIfAborted(null==n?void 0:n.signal);const l=r.getDataSource(t);if(!l)throw new Error("Property data source not found");const i=l.url;if(!i)throw new Error("Data source URL not available");if(!c||!p){const e=yield(0,o.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer","esri/rest/support/Query"]),[t,r]=e;c=t,p=r}const s=c,u=p;if(!s||!u)throw new Error("Property query modules failed to load");let f=d.get(i);f||(f=new s({url:i}),d.set(i,f));const h=new u({geometry:e,returnGeometry:!0,outFields:["*"],spatialRelationship:"intersects"}),b=yield f.queryFeatures(h,g(null==n?void 0:n.signal));return a.abortHelpers.throwIfAborted(null==n?void 0:n.signal),(null==b?void 0:b.features)&&0!==b.features.length?b.features.map((e=>({features:[e],propertyId:e.attributes.FNR}))):[]}catch(e){if((0,a.isAbortError)(e))throw e instanceof Error?e:new Error(String(e));throw new Error((0,a.parseArcGISError)(e,"Property query failed"))}})),S=(e,t,r,o)=>l(void 0,void 0,void 0,(function*(){var n;try{a.abortHelpers.throwIfAborted(null==o?void 0:o.signal);const l=r.getDataSource(t);if(!l)throw new Error("Owner data source not found");const i=g(null==o?void 0:o.signal),s=yield l.query({where:(0,a.buildFnrWhereClause)(e),returnGeometry:!1,outFields:["*"]},h(i));a.abortHelpers.throwIfAborted(null==o?void 0:o.signal);const u=null!==(n=null==s?void 0:s.records)&&void 0!==n?n:[];return 0===u.length?[]:u.map((e=>({attributes:e.getData()})))}catch(e){throw a.abortHelpers.handleOrThrow(e),new Error((0,a.parseArcGISError)(e,"Owner query failed"))}}))},6426:e=>{e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,r=[],o=0;o<e.rangeCount;o++)r.push(e.getRangeAt(o));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||r.forEach((function(t){e.addRange(t)})),t&&t.focus()}}},7390:(e,t,r)=>{var o;!function(){"use strict";var n=function e(t){var r,o="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),n={use_static:!1};function a(e){var t=Object.getPrototypeOf(e);return t?Object.create(t):{}}function l(e,t,r){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!1,value:r})}"object"!=typeof(r=t)||Array.isArray(r)||null===r||void 0!==t.use_static&&(n.use_static=Boolean(t.use_static));var i="__immutable_invariants_hold";function s(e){return"object"!=typeof e||(null===e||Boolean(Object.getOwnPropertyDescriptor(e,i)))}function u(e,t){return e===t||e!=e&&t!=t}function c(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof Date)}var p=["setPrototypeOf"],d=(p.concat(["push","pop","sort","splice","shift","unshift","reverse"]),["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]));function f(e){this.name="MyError",this.message=e,this.stack=(new Error).stack}function g(e,t){return l(e,i,!0),e}function h(e,t){var r=e[t];l(e,t,(function(){return _(r.apply(e,arguments))}))}function b(e,t,r){var o=r&&r.deep;if(e in this&&(o&&this[e]!==t&&c(t)&&c(this[e])&&(t=_.merge(this[e],t,{deep:!0,mode:"replace"})),u(this[e],t)))return this;var n=D.call(this);return n[e]=_(t),v(n)}p.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]),f.prototype=new Error,f.prototype.constructor=Error;var y=_([]);function w(e,t,r){var o=e[0];if(1===e.length)return b.call(this,o,t,r);var n,a=e.slice(1),l=this[o];if("object"==typeof l&&null!==l)n=_.setIn(l,a,t);else{var i=a[0];n=""!==i&&isFinite(i)?w.call(y,a,t):L.call(O,a,t)}if(o in this&&l===n)return this;var s=D.call(this);return s[o]=n,v(s)}function v(e){for(var t in d){if(d.hasOwnProperty(t))h(e,d[t])}n.use_static||(l(e,"flatMap",I),l(e,"asObject",M),l(e,"asMutable",D),l(e,"set",b),l(e,"setIn",w),l(e,"update",k),l(e,"updateIn",U),l(e,"getIn",H));for(var r=0,o=e.length;r<o;r++)e[r]=_(e[r]);return g(e)}function m(){return new Date(this.getTime())}function I(e){if(0===arguments.length)return this;var t,r=[],o=this.length;for(t=0;t<o;t++){var n=e(this[t],t,this);Array.isArray(n)?r.push.apply(r,n):r.push(n)}return v(r)}function S(e){if(void 0===e&&0===arguments.length)return this;if("function"!=typeof e){var t=Array.isArray(e)?e.slice():Array.prototype.slice.call(arguments);t.forEach((function(e,t,r){"number"==typeof e&&(r[t]=e.toString())})),e=function(e,r){return-1!==t.indexOf(r)}}var r=a(this);for(var o in this)this.hasOwnProperty(o)&&!1===e(this[o],o)&&(r[o]=this[o]);return F(r)}function D(e){var t,r,o=[];if(e&&e.deep)for(t=0,r=this.length;t<r;t++)o.push(R(this[t]));else for(t=0,r=this.length;t<r;t++)o.push(this[t]);return o}function M(e){"function"!=typeof e&&(e=function(e){return e});var t,r={},o=this.length;for(t=0;t<o;t++){var n=e(this[t],t,this),a=n[0],l=n[1];r[a]=l}return F(r)}function R(e){return!e||"object"!=typeof e||!Object.getOwnPropertyDescriptor(e,i)||e instanceof Date?e:_.asMutable(e,{deep:!0})}function A(e,t){for(var r in e)Object.getOwnPropertyDescriptor(e,r)&&(t[r]=e[r]);return t}function T(e,t){if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(e));var r,o,n=Array.isArray(e),l=t&&t.deep,i=t&&t.mode||"merge",s=t&&t.merger;function p(e,o,n){var i,p=_(o[n]),d=s&&s(e[n],p,t),f=e[n];void 0===r&&void 0===d&&e.hasOwnProperty(n)&&u(p,f)||(u(f,i=void 0!==d?d:l&&c(f)&&c(p)?_.merge(f,p,t):p)&&e.hasOwnProperty(n)||(void 0===r&&(r=A(e,a(e))),r[n]=i))}if(n)for(var d=0,f=e.length;d<f;d++){var g=e[d];for(o in g)g.hasOwnProperty(o)&&p(void 0!==r?r:this,g,o)}else{for(o in e)Object.getOwnPropertyDescriptor(e,o)&&p(this,e,o);"replace"===i&&function(e,t){for(var o in e)t.hasOwnProperty(o)||(void 0===r&&(r=A(e,a(e))),delete r[o])}(this,e)}return void 0===r?this:F(r)}function x(e,t){var r=t&&t.deep;if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(e));return _.merge(this,e,{deep:r,mode:"replace"})}var E,j,N,O=_({});function L(e,t,r){if(!Array.isArray(e)||0===e.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var o=e[0];if(1===e.length)return C.call(this,o,t,r);var n,l=e.slice(1),i=this[o];if(n=this.hasOwnProperty(o)&&"object"==typeof i&&null!==i?_.setIn(i,l,t):L.call(O,l,t),this.hasOwnProperty(o)&&i===n)return this;var s=A(this,a(this));return s[o]=n,F(s)}function C(e,t,r){var o=r&&r.deep;if(this.hasOwnProperty(e)&&(o&&this[e]!==t&&c(t)&&c(this[e])&&(t=_.merge(this[e],t,{deep:!0,mode:"replace"})),u(this[e],t)))return this;var n=A(this,a(this));return n[e]=_(t),F(n)}function k(e,t){var r=Array.prototype.slice.call(arguments,2),o=this[e];return _.set(this,e,t.apply(o,[o].concat(r)))}function P(e,t){for(var r=0,o=t.length;null!=e&&r<o;r++)e=e[t[r]];return r&&r==o?e:void 0}function U(e,t){var r=Array.prototype.slice.call(arguments,2),o=P(this,e);return _.setIn(this,e,t.apply(o,[o].concat(r)))}function H(e,t){var r=P(this,e);return void 0===r?t:r}function z(e){var t,r=a(this);if(e&&e.deep)for(t in this)this.hasOwnProperty(t)&&(r[t]=R(this[t]));else for(t in this)this.hasOwnProperty(t)&&(r[t]=this[t]);return r}function W(){return{}}function F(e){return n.use_static||(l(e,"merge",T),l(e,"replace",x),l(e,"without",S),l(e,"asMutable",z),l(e,"set",C),l(e,"setIn",L),l(e,"update",k),l(e,"updateIn",U),l(e,"getIn",H)),g(e)}function _(e,t,r){if(s(e)||function(e){return"object"==typeof e&&null!==e&&(60103===e.$$typeof||e.$$typeof===o)}(e)||function(e){return"undefined"!=typeof File&&e instanceof File}(e)||function(e){return"undefined"!=typeof Blob&&e instanceof Blob}(e)||function(e){return e instanceof Error}(e))return e;if(function(e){return"object"==typeof e&&"function"==typeof e.then}(e))return e.then(_);if(Array.isArray(e))return v(e.slice());if(e instanceof Date)return a=new Date(e.getTime()),n.use_static||l(a,"asMutable",m),g(a);var a,i=t&&t.prototype,u=(i&&i!==Object.prototype?function(){return Object.create(i)}:W)();for(var c in e)Object.getOwnPropertyDescriptor(e,c)&&(u[c]=_(e[c],void 0,r));return F(u)}function B(e){return function(){var t=[].slice.call(arguments),r=t.shift();return e.apply(r,t)}}function Q(e,t){return function(){var r=[].slice.call(arguments),o=r.shift();return Array.isArray(o)?t.apply(o,r):e.apply(o,r)}}return _.from=_,_.isImmutable=s,_.ImmutableError=f,_.merge=B(T),_.replace=B(x),_.without=B(S),_.asMutable=(E=z,j=D,N=m,function(){var e=[].slice.call(arguments),t=e.shift();return Array.isArray(t)?j.apply(t,e):t instanceof Date?N.apply(t,e):E.apply(t,e)}),_.set=Q(C,b),_.setIn=Q(L,w),_.update=B(k),_.updateIn=B(U),_.getIn=B(H),_.flatMap=B(I),_.asObject=B(M),n.use_static||(_.static=e({use_static:!0})),Object.freeze(_),_}();void 0===(o=function(){return n}.call(t,r,t,e))||(e.exports=o)}()},7507:(e,t,r)=>{"use strict";var o,n;r.d(t,{_:()=>n}),function(e){e.QUERY_ERROR="QUERY_ERROR",e.NETWORK_ERROR="NETWORK_ERROR",e.VALIDATION_ERROR="VALIDATION_ERROR",e.GEOMETRY_ERROR="GEOMETRY_ERROR"}(o||(o={})),function(e){e.SET_ERROR="PROPERTY_WIDGET/SET_ERROR",e.CLEAR_ERROR="PROPERTY_WIDGET/CLEAR_ERROR",e.SET_SELECTED_PROPERTIES="PROPERTY_WIDGET/SET_SELECTED_PROPERTIES",e.CLEAR_ALL="PROPERTY_WIDGET/CLEAR_ALL",e.SET_QUERY_IN_FLIGHT="PROPERTY_WIDGET/SET_QUERY_IN_FLIGHT",e.SET_RAW_RESULTS="PROPERTY_WIDGET/SET_RAW_RESULTS",e.REMOVE_WIDGET_STATE="PROPERTY_WIDGET/REMOVE_WIDGET_STATE"}(n||(n={}))},7519:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCINCiAgICAgICAgZD0iTTE1IDhDMTUgMTEuODY2IDExLjg2NiAxNSA4IDE1QzQuMTM0MDEgMTUgMSAxMS44NjYgMSA4QzEgNC4xMzQwMSA0LjEzNDAxIDEgOCAxQzExLjg2NiAxIDE1IDQuMTM0MDEgMTUgOFpNMTYgOEMxNiAxMi40MTgzIDEyLjQxODMgMTYgOCAxNkMzLjU4MTcyIDE2IDAgMTIuNDE4MyAwIDhDMCAzLjU4MTcyIDMuNTgxNzIgMCA4IDBDMTIuNDE4MyAwIDE2IDMuNTgxNzIgMTYgOFpNOC4zMjQwNiAxMC4yMjhINy4zNDAwNkM3LjEyNzQ1IDkuMDg5NTIgNy45NjE0MSA4LjA5ODY4IDguNzE1MSA3LjIwMzIxQzkuMjgwMTQgNi41MzE4OCA5LjgwMDA2IDUuOTE0MTUgOS44MDAwNiA1LjMyOEM5LjgwMDA2IDQuNSA5LjIwMDA2IDMuOSA3Ljk3NjA2IDMuOUM3LjE2MDA2IDMuOSA2LjQwNDA2IDQuMjYgNS43MDgwNiA0Ljk5Mkw1LjA2MDA2IDQuMzkyQzUuODUyMDYgMy41NTIgNi43ODgwNiAzIDguMDk2MDYgM0M5Ljc4ODA2IDMgMTAuODY4MSAzLjg2NCAxMC44NjgxIDUuMjQ0QzEwLjg2ODEgNi4xMDgyIDEwLjIxNTcgNi44NzIzMiA5LjU2ODM3IDcuNjMwNTJDOC44NTg0NCA4LjQ2MjA2IDguMTU0NTggOS4yODY0OCA4LjMyNDA2IDEwLjIyOFpNOC42MjQwNiAxMi40QzguNjI0MDYgMTIuODggOC4yNzYwNiAxMy4xOTIgNy44NTYwNiAxMy4xOTJDNy40MjQwNiAxMy4xOTIgNy4wNzYwNiAxMi44OCA3LjA3NjA2IDEyLjRDNy4wNzYwNiAxMS45MiA3LjQyNDA2IDExLjU5NiA3Ljg1NjA2IDExLjU5NkM4LjI3NjA2IDExLjU5NiA4LjYyNDA2IDExLjkyIDguNjI0MDYgMTIuNFoiDQogICAgICAgIGZpbGw9ImJsYWNrIiAvPg0KPC9zdmc+"},7965:(e,t,r)=>{"use strict";var o=r(6426),n={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(e,t){var r,a,l,i,s,u,c=!1;t||(t={}),r=t.debug||!1;try{if(l=o(),i=document.createRange(),s=document.getSelection(),(u=document.createElement("span")).textContent=e,u.ariaHidden="true",u.style.all="unset",u.style.position="fixed",u.style.top=0,u.style.clip="rect(0, 0, 0, 0)",u.style.whiteSpace="pre",u.style.webkitUserSelect="text",u.style.MozUserSelect="text",u.style.msUserSelect="text",u.style.userSelect="text",u.addEventListener("copy",(function(o){if(o.stopPropagation(),t.format)if(o.preventDefault(),void 0===o.clipboardData){r&&console.warn("unable to use e.clipboardData"),r&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var a=n[t.format]||n.default;window.clipboardData.setData(a,e)}else o.clipboardData.clearData(),o.clipboardData.setData(t.format,e);t.onCopy&&(o.preventDefault(),t.onCopy(o.clipboardData))})),document.body.appendChild(u),i.selectNodeContents(u),s.addRange(i),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");c=!0}catch(o){r&&console.error("unable to copy using execCommand: ",o),r&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),c=!0}catch(o){r&&console.error("unable to copy using clipboardData: ",o),r&&console.error("falling back to prompt"),a=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in t?t.message:"Copy to clipboard: #{key}, Enter"),window.prompt(a,e)}}finally{s&&("function"==typeof s.removeRange?s.removeRange(i):s.removeAllRanges()),u&&document.body.removeChild(u),l()}return c}},8491:(e,t,r)=>{"use strict";r.r(t),r.d(t,{abortHelpers:()=>C,buildFnrWhereClause:()=>U,buildHighlightColor:()=>T,buildHighlightSymbolJSON:()=>x,buildTooltipSymbol:()=>I,calculatePropertyUpdates:()=>F,cleanupRemovedGraphics:()=>H,computeWidgetsToClose:()=>$,copyToClipboard:()=>ie,createPropertyDispatcher:()=>V,createRowId:()=>E,cursorLifecycleHelpers:()=>fe,dataSourceHelpers:()=>pe,executeHoverQuery:()=>Z,extractFnr:()=>j,formatAddressOnly:()=>A,formatOwnerInfo:()=>M,formatPropertyWithShare:()=>R,generateFBWebbUrl:()=>le,getValidatedOutlineWidth:()=>P,isAbortError:()=>O,isDuplicateProperty:()=>z,isValidFbwebbBaseUrl:()=>ae,isValidationFailure:()=>a.kf,isValidationSuccess:()=>a.jf,logger:()=>g,maskAddress:()=>w,maskName:()=>y,maskPassword:()=>se,normalizeFnrKey:()=>N,normalizeHostList:()=>ce,normalizeHostValue:()=>ue,numberHelpers:()=>L,opacityHelpers:()=>ee,outlineWidthHelpers:()=>te,ownerIdentity:()=>m,ownerPrivacy:()=>b,parseArcGISError:()=>k,popupSuppressionManager:()=>de,processPropertyQueryResults:()=>G,shouldSkipHoverQuery:()=>J,shouldToggleRemove:()=>W,stripHtml:()=>d,syncCursorGraphics:()=>S,syncGraphicsWithState:()=>B,textSanitizer:()=>p,updateGraphicSymbol:()=>q,updateRawPropertyResults:()=>Y,validateMapClickInputs:()=>_,validateMapClickPipeline:()=>Q,validateNumericRange:()=>X});var o=r(7965),n=r.n(o),a=r(1528),l=r(6250),i=r(2796),s=r(844),u=function(e,t,r,o){return new(r||(r=Promise))((function(n,a){function l(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,i)}s((o=o.apply(e,t||[])).next())}))};const c=e=>{if(!e)return"";return((new DOMParser).parseFromString(e,"text/html").body.textContent||"").replace(/[\s\u00A0\u200B]+/g," ").trim()},p={sanitize:c,stripHtml:e=>c(e)},d=e=>p.stripHtml(e),f=e=>"object"==typeof e&&null!==e,g={debug:(e,t)=>{},warn:(e,t)=>{},error:(e,t,r)=>{console.error(`Property Widget: ${e}`,t,r||{})}},h=(e,t)=>{const r=c(e);return r.length<t?"***":r},b={maskName:e=>{const t=h(e,i.nV);return"***"===t?t:t.split(" ").filter(Boolean).map((e=>`${e.charAt(0)}${"*".repeat(Math.min(i.qC,e.length-1))}`)).join(" ")},maskAddress:e=>{const t=h(e,i.nV);return"***"===t?t:`${t.substring(0,2)}${"*".repeat(Math.min(5,t.length-2))}`}},y=b.maskName,w=b.maskAddress,v=e=>null==e?"":"number"==typeof e?c(String(e)):"string"==typeof e?c(e):"",m={buildKey:(e,t,r)=>{const o=[()=>{const t=v(e.AGARLISTA);return t?`A:${t.toLowerCase()}`:null},()=>{const t=[e.NAMN&&`N:${v(e.NAMN)}`,e.BOSTADR&&`B:${v(e.BOSTADR)}`,e.POSTNR&&`P:${v(e.POSTNR)}`,e.POSTADR&&`C:${v(e.POSTADR)}`,e.ORGNR&&`O:${v(e.ORGNR)}`,e.ANDEL&&`S:${v(e.ANDEL)}`].filter(Boolean);return t.length>0?t.join("|").toLowerCase():null},()=>{const r=[t.propertyId&&`PR:${v(t.propertyId)}`,void 0!==t.fnr&&null!==t.fnr&&`FN:${String(t.fnr)}`,void 0!==e.OBJECTID&&null!==e.OBJECTID&&`OB:${String(e.OBJECTID)}`,e.UUID_FASTIGHET&&`UU:${v(e.UUID_FASTIGHET)}`].filter(Boolean);return r.length>0?r.join("|").toLowerCase():null},()=>`IX:${null!=r?r:0}`];for(const e of o){const t=e();if(t)return t}return`IX:${null!=r?r:0}`},normalizeValue:v},I=(e,t,r)=>{if(!(null==e?void 0:e.TextSymbol)||!t)return null;const o=d(t);return o?new e.TextSymbol({text:o,color:r.textColor,backgroundColor:r.backgroundColor,horizontalAlignment:r.horizontalAlignment,verticalAlignment:r.verticalAlignment,xoffset:r.xoffset,yoffset:r.yoffset,lineWidth:r.lineWidth,lineHeight:r.lineHeight,font:{family:r.fontFamily,size:r.fontSize,weight:r.fontWeight},kerning:r.kerning}):null},S=({modules:e,layer:t,mapPoint:r,tooltipText:o,highlightColor:n,existing:a,style:l=i.Dj})=>{var s,u,c;if(!(null==e?void 0:e.Graphic)||!t)return null!=a?a:null;if(!r)return(null==a?void 0:a.pointGraphic)&&t.remove(a.pointGraphic),(null==a?void 0:a.tooltipGraphic)&&t.remove(a.tooltipGraphic),null;const p={pointGraphic:null!==(s=null==a?void 0:a.pointGraphic)&&void 0!==s?s:null,tooltipGraphic:null!==(u=null==a?void 0:a.tooltipGraphic)&&void 0!==u?u:null,lastTooltipText:null!==(c=null==a?void 0:a.lastTooltipText)&&void 0!==c?c:null};if(p.pointGraphic?p.pointGraphic.geometry=r:(p.pointGraphic=new e.Graphic({geometry:r,symbol:new e.SimpleMarkerSymbol({style:"cross",size:i.Ye,color:n,outline:{color:[n[0],n[1],n[2],1],width:2.5}})}),t.add(p.pointGraphic)),o){if(p.lastTooltipText!==o){const n=I(e,o,l);n?(p.tooltipGraphic?(p.tooltipGraphic.geometry=r,p.tooltipGraphic.symbol=n):(p.tooltipGraphic=new e.Graphic({geometry:r,symbol:n}),t.add(p.tooltipGraphic)),p.lastTooltipText=o):p.tooltipGraphic&&(t.remove(p.tooltipGraphic),p.tooltipGraphic=null,p.lastTooltipText=null)}else p.tooltipGraphic&&(p.tooltipGraphic.geometry=r)}else p.tooltipGraphic&&(t.remove(p.tooltipGraphic),p.tooltipGraphic=null,p.lastTooltipText=null);return p},D=(e,t)=>{const r=(e=>{const t=new Set;return e.map((e=>e.trim())).filter((e=>!(!e||t.has(e)||(t.add(e),0))))})(c(String(e)).split(";"));return t?r.map((e=>(e=>{const t=e.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(!t)return b.maskName(e);const[,r,o]=t;return`${b.maskName(r.trim())} (${o.trim()})`})(e))).filter(Boolean).join("; "):r.join("; ")},M=(e,t,r)=>e.AGARLISTA&&"string"==typeof e.AGARLISTA?D(e.AGARLISTA,t):((e,t,r)=>{const o=c(e.NAMN||"")||r,n=t&&o!==r?b.maskName(o):o,a=c(e.BOSTADR||""),l=t&&a?b.maskAddress(a):a,i=c(e.POSTNR||"").replace(/\s+/g,""),s=c(e.POSTADR||""),u=c(e.ORGNR||"");return`${[n,l,i&&s?`${i} ${s}`:i||s].filter(Boolean).join(", ")}${u?` (${u})`:""}`.trim()||r})(e,t,r),R=(e,t)=>{const r=null==t?void 0:t.trim(),o=`${e}\xa0`;return r?`${o}(${r})`:o},A=(e,t)=>{const r=c(e.BOSTADR||""),o=t&&r?b.maskAddress(r):r,n=c(e.POSTNR||"").replace(/\s+/g,""),a=c(e.POSTADR||""),l=[];o&&l.push(o);const i=[n,a].filter(Boolean).join(" ");return i&&l.push(i),l.join(", ")},T=(e,t)=>{const r="string"==typeof e?e.trim():"",o=r?i.pd.exec(r):null,n=o?o[1]:e.replace("#","");return[parseInt(n.substring(0,2),16),parseInt(n.substring(2,4),16),parseInt(n.substring(4,6),16),"number"==typeof t&&Number.isFinite(t)?t<0?0:t>1?1:t:.4]},x=(e,t,r)=>{const[o,n,a,l]=e;return"polyline"===r?{style:"solid",color:[o,n,a,l],width:t}:"point"===r?{style:"cross",color:[o,n,a,l],size:i.Ye,outline:{style:"solid",color:[o,n,a,1],width:t}}:{style:"solid",color:[o,n,a,l],outline:{style:"solid",color:[o,n,a,1],width:t}}},E=(e,t)=>`${e}_${t}`,j=e=>{var t;if(!e)return null;const r=null!==(t=e.FNR)&&void 0!==t?t:e.fnr;return"string"==typeof r||"number"==typeof r?r:null},N=e=>null!=e?String(e):"",O=e=>{if(!e||"object"!=typeof e)return!1;const t=e;return"AbortError"===t.name||"string"==typeof t.message&&t.message.toLowerCase().includes("abort")},L={isFiniteNumber:e=>"number"==typeof e&&Number.isFinite(e),clamp:(e,t,r)=>Number.isFinite(e)?e<t?t:e>r?r:e:t,clampWithDefault:(e,t,r,o)=>L.isFiniteNumber(e)?L.clamp(e,t,r):o},C={throwIfAborted:e=>{if(null==e?void 0:e.aborted){const e=new Error("AbortError");throw e.name="AbortError",e}},checkAbortedOrStale:(e,t)=>t()?"stale":e.aborted?"aborted":"active",handleOrThrow:(e,t)=>{if(O(e))throw null==t||t(),e}},k=(e,t)=>{if(!e)return t;if("string"==typeof e)return e;if(f(e)){const t="details"in e?e.details:void 0;if(f(t)){const e=t.message;if("string"==typeof e)return e}const r="message"in e?e.message:void 0;if("string"==typeof r)return r}return t},P=e=>"number"==typeof e&&Number.isFinite(e)?e<.5?.5:e>10?10:e:1,U=(e,t="Invalid FNR: must be a safe integer")=>{if("number"==typeof e){if(!Number.isFinite(e)||!Number.isSafeInteger(e)||e<0)throw new Error(t);return`FNR = ${e}`}const r=String(e).replace(/'/g,"''");if(!r.trim())throw new Error("Invalid FNR: cannot be empty or whitespace-only");return`FNR = '${r}'`},H=e=>{const{toRemove:t,removeGraphicsForFnr:r,normalizeFnrKey:o}=e;t.forEach((e=>{r(e,o)}))},z=(e,t)=>{const r=N(e);return t.some((e=>N(e.FNR)===r))},W=(e,t,r)=>!!r&&z(e,t),F=(e,t,r,o)=>{const n=new Map,a=new Map;t.forEach((e=>{const t=N(e.FNR),r=n.get(t);r?r.push(e):n.set(t,[e]),a.set(e.id,e)}));const l=new Set,i=[],s=new Set;e.forEach((e=>{const t=N(e.FNR);if(r&&!l.has(t)){const e=n.get(t);if(e&&e.length>0)return void l.add(t)}a.has(e.id)||s.has(e.id)||(i.push(e),s.add(e.id))}));const u=l.size>0?t.filter((e=>!l.has(N(e.FNR)))):t.slice();return u.push(...i),u.length>o&&(u.length=o),{toRemove:l,toAdd:i,updatedRows:u}},_=e=>{const{event:t,modules:r,translate:o}=e;return r?(null==t?void 0:t.mapPoint)?{valid:!0,data:{mapPoint:t.mapPoint}}:{valid:!1,error:{type:"GEOMETRY_ERROR",message:o("errorNoMapPoint")},failureReason:"no_map_point"}:{valid:!1,error:{type:"VALIDATION_ERROR",message:o("errorLoadingModules")},failureReason:"modules_not_loaded"}},B=e=>{const{graphicsToAdd:t,selectedRows:r,view:o,helpers:n,highlightColor:a,outlineWidth:l}=e;if(!o)return!1;const i=new Set(r.map((e=>n.normalizeFnrKey(e.FNR)))),s=t.filter((({fnr:e})=>{const t=n.normalizeFnrKey(e);return i.has(t)}));return s.length>0&&(n.addManyGraphicsToMap?n.addManyGraphicsToMap(s,o,n.extractFnr,n.normalizeFnrKey,a,l):s.forEach((({graphic:e})=>{n.addGraphicsToMap(e,o,n.extractFnr,n.normalizeFnrKey,a,l)}))),!0},Q=e=>{const{event:t,modules:r,config:o,dsManager:n,translate:i}=e,s=_({event:t,modules:r,translate:i});if((0,a.kf)(s))return s;const u=(0,l.PM)({propertyDsId:o.propertyDataSourceId,ownerDsId:o.ownerDataSourceId,dsManager:n,allowedHosts:o.allowedHosts,translate:i});if((0,a.kf)(u))return u;const c=u;return{valid:!0,data:{mapPoint:s.data.mapPoint,manager:c.data.manager}}},G=e=>u(void 0,void 0,void 0,(function*(){const{propertyResults:t,config:r,processingContext:o,services:n}=e;return r.enableBatchOwnerQuery&&void 0!==r.relationshipId&&r.propertyDataSourceId&&void 0!==r.relationshipId?yield n.processBatch({propertyResults:t,config:{propertyDataSourceId:r.propertyDataSourceId,ownerDataSourceId:r.ownerDataSourceId,enablePIIMasking:r.enablePIIMasking,relationshipId:r.relationshipId},context:o}):yield n.processIndividual({propertyResults:t,config:{ownerDataSourceId:r.ownerDataSourceId,enablePIIMasking:r.enablePIIMasking},context:o})})),Y=(e,t,r,o,n,a)=>{const l=e instanceof Map?e:new Map(Object.entries(e||{}).map((([e,t])=>[e,t]))),i=e=>{if(null==e)return null;if(Array.isArray(e))return e.map((e=>i(e)));if(f(e)){const t=e;if("function"==typeof t.toJSON)return i(t.toJSON());try{return JSON.parse(JSON.stringify(e))}catch(t){const r={};return Object.entries(e).forEach((([e,t])=>{r[e]=i(t)})),r}}return"string"==typeof e||"number"==typeof e||"boolean"==typeof e?e:null},s=e=>{var t;return{propertyId:null!==(t=null==e?void 0:e.propertyId)&&void 0!==t?t:"",features:Array.isArray(null==e?void 0:e.features)?e.features.map((e=>(e=>{var t,r;if(!e)return{attributes:null,geometry:null,aggregateGeometries:null,symbol:null,popupTemplate:null};const o=e.geometry,n=o?"function"==typeof o.toJSON?o.toJSON():i(o):null,a=e.aggregateGeometries;return{attributes:e.attributes&&"object"==typeof e.attributes?Object.assign({},e.attributes):null,geometry:null!=n?n:null,aggregateGeometries:i(null!=a?a:null),symbol:i(null!==(t=e.symbol)&&void 0!==t?t:null),popupTemplate:i(null!==(r=e.popupTemplate)&&void 0!==r?r:null)}})(e))):[]}},u=new Map(l),c=new Map;r.forEach((e=>{var t,r;const o=null===(t=null==e?void 0:e.features)||void 0===t?void 0:t[0],n=null==o?void 0:o.attributes,l=null!==(r=null==n?void 0:n.FNR)&&void 0!==r?r:null==n?void 0:n.fnr;null!=l&&c.set(a(l),s(e))}));let p=0;const d=new Map;n.forEach((e=>{d.set(a(e.FNR),e.id)})),t.forEach((e=>{const t=a(e.FNR);let o=c.get(t);if(!o&&r.length>0){const e=s(r[Math.min(p,r.length-1)]);p+=1,o=e}o&&u.set(e.id,o)})),o.forEach((e=>{const t=d.get(e);t&&u.delete(t)}));const g={};return u.forEach(((e,t)=>{g[t]=e})),g},V=(e,t)=>{const r=r=>{t&&"function"==typeof e&&e(r)};return{setError:e=>{r(s.propertyActions.setError(e,t))},clearError:()=>{r(s.propertyActions.clearError(t))},setSelectedProperties:e=>{r(s.propertyActions.setSelectedProperties(Array.from(e),t))},clearAll:()=>{r(s.propertyActions.clearAll(t))},setQueryInFlight:e=>{r(s.propertyActions.setQueryInFlight(e,t))},setRawResults:e=>{r(s.propertyActions.setRawResults(e,t))},removeWidgetState:()=>{r(s.propertyActions.removeWidgetState(t))}}},$=(e,t,r)=>{if(!e)return[];const o=[],n=e=>f(e)&&"function"==typeof e.get,a=(e,t)=>{if(e)return n(e)?e.get(t):f(e)?e[t]:void 0},l=(e,t)=>{if(!e)return"";if(n(e)){const r=e.get(t);return"string"==typeof r?r:""}if(f(e)){const r=e[t];return"string"==typeof r?r:""}return""},i=e=>{if(!e)return!1;const t=e.toLowerCase();return t.includes("property")||t.includes("fastighet")},s=e=>{const t=a(r,e);if(!t)return!1;const o=a(t,"manifest");return[l(t,"name"),l(t,"label"),l(t,"manifestLabel"),l(t,"uri"),l(t,"widgetName"),l(o,"name"),l(o,"label"),l(o,"uri")].some(i)};for(const[r,n]of Object.entries(e)){if(r===t||!n)continue;const e=n.state;if(!e)continue;const a="string"==typeof e?e:"number"==typeof e?String(e):null;if(!a)continue;const l=a.toUpperCase();"CLOSED"!==l&&"HIDDEN"!==l&&(n.isClassLoaded&&s(r)&&o.push(r))}return o},Z=e=>u(void 0,void 0,void 0,(function*(){var t,r,o;const{mapPoint:n,config:i,dsManager:s,signal:u,enablePIIMasking:c,translate:p}=e,d=(0,l.PM)({propertyDsId:i.propertyDataSourceId,ownerDsId:i.ownerDataSourceId,dsManager:s,allowedHosts:i.allowedHosts,translate:p});if((0,a.kf)(d))return null;const{manager:f}=d.data,g=yield(0,l.XW)(n,i.propertyDataSourceId,f,{signal:u});if(C.throwIfAborted(u),!g.length||!(null===(r=null===(t=g[0])||void 0===t?void 0:t.features)||void 0===r?void 0:r.length))return null;const h=g[0].features[0],b=j(h.attributes),y=(null===(o=h.attributes)||void 0===o?void 0:o.FASTIGHET)||"";if(!b||!y)return null;const w=yield(0,l.nS)(b,i.ownerDataSourceId,f,{signal:u});C.throwIfAborted(u);let v=p("unknownOwner");if(w.length>0){const e=w[0].attributes;v=M(e,c,p("unknownOwner"))}return{fastighet:y,bostadr:v}})),J=(e,t,r)=>{if(!t)return!1;const o=e.x-t.x,n=e.y-t.y;return Math.sqrt(o*o+n*n)<r},q=(e,t,r,o)=>{if(!e||!e.geometry)return;const n=e.geometry,a=x(t,r,n.type);"polygon"===n.type||"extent"===n.type?e.symbol=new o.SimpleFillSymbol(a):"polyline"===n.type?e.symbol=new o.SimpleLineSymbol(a):"point"!==n.type&&"multipoint"!==n.type||(e.symbol=new o.SimpleMarkerSymbol(a))},X=e=>{const{value:t,min:r,max:o,errorMessage:n}=e,a="string"==typeof t?parseInt(t,10):t;return isNaN(a)||a<r||a>o?{valid:!1,error:n}:{valid:!0,normalized:a}},K=(e,t,r)=>Number.isFinite(e)?e<t?t:e>r?r:e:t,ee={toPercent:e=>{const t=K(e,0,1);return Math.round(100*t)},fromPercent:e=>K(e,0,100)/100,formatPercent:e=>`${K(Math.round(e),0,100)}%`},te={normalize:e=>{const t=K(e,.5,10);return Math.round(2*t)/2},formatDisplay:e=>{const t=K(e,.5,10),r=Math.round(2*t)/2,o=Math.round(r);return Math.abs(r-o)<1e-4?String(o):r.toFixed(1)}},re=e=>d(e||"").trim(),oe=e=>"string"!=typeof e?"":e.trim(),ne=e=>{if(null==e)return null;return d(String(e)).replace(/[^0-9A-Za-z]/g,"")||null},ae=e=>{const t=re(e);if(!t||t.length>2048)return!1;try{const e=new URL(t);return"https:"===e.protocol&&((!e.port||"443"===e.port)&&!(!e.hostname||(e=>{const t=e.toLowerCase();return"localhost"===t||"127.0.0.1"===t||"::1"===t||"[::1]"===t||/^10\./.test(t)||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(t)||/^192\.168\./.test(t)})(e.hostname)))}catch(e){return!1}},le=(e,t,r)=>{const o=re(t);if(!ae(o))throw new Error("Invalid FBWebb base URL");const n=Array.from(new Set((Array.isArray(e)?e:[]).map(ne).filter((e=>Boolean(e)))));if(0===n.length)throw new Error("No FNRs provided");const a=oe(r.user),l=oe(r.password),i=oe(r.database);if(!a||!l||!i)throw new Error("Missing FBWebb configuration");const s=new URL(o),u=new URLSearchParams;u.set("User",a),u.set("Pass",l),u.set("Database",i);const c=n.join(",");return s.search=`${u.toString()}&fnr=${c}`,s.toString()},ie=e=>{try{return n()(e,{debug:!1,format:"text/plain"})}catch(e){return!1}},se=e=>{const t=oe(e);if(!t)return"****";if(t.length<=2)return t;const r=t.slice(0,2),o=Math.min(4,Math.max(1,t.length-2));return`${r}${"*".repeat(o)}`},ue=e=>d(e||"").trim(),ce=e=>{if(!e||0===e.length)return[];const t=e.map(ue).filter((e=>e.length>0));return Array.from(new Set(t))},pe={extractId:e=>{if(!e||"object"!=typeof e)return null;if((t=e)&&"object"==typeof t&&"function"==typeof t.get){const t=e.get("dataSourceId");return"string"==typeof t?t:null}var t;if("dataSourceId"in e){const t=e.dataSourceId;return"string"==typeof t?t:null}return null},findById:(e,t)=>{var r;if(!t||!e)return null;const o=e;if("function"==typeof o.find){const e=o.find((e=>!!e&&pe.extractId(e)===t));if(e)return e}if((n=e)&&"object"==typeof n&&"function"==typeof n.asMutable){const r=e.asMutable({deep:!1});if(Array.isArray(r))return pe.findById(r,t)}var n;if(Array.isArray(e)||(e=>!(!e||"object"!=typeof e)&&"number"==typeof e.length)(e)){const o=e,n=null!==(r=o.length)&&void 0!==r?r:0;for(let e=0;e<n;e+=1){const r=o[e];if(r&&pe.extractId(r)===t)return r}}return null}};const de=new class{constructor(){this.ownersByView=new WeakMap,this.originalStateByView=new WeakMap}resolveView(e){return e}acquire(e,t){if(!t)return;const r=this.resolveView(t),o=r.popupEnabled;if("boolean"!=typeof o)return;let n=this.ownersByView.get(t);n||(n=new Set,this.ownersByView.set(t,n),this.originalStateByView.set(t,o)),n.add(e),r.popupEnabled=!1}release(e,t){if(!t)return;const r=this.ownersByView.get(t);r&&r.delete(e)&&0===r.size&&this.restorePopupState(t)}restorePopupState(e){const t=this.originalStateByView.get(e);if(void 0!==t){this.resolveView(e).popupEnabled=t,this.originalStateByView.delete(e),this.ownersByView.delete(e)}}},fe={cleanupHandles:e=>{e.pointerMoveHandle.current&&(e.pointerMoveHandle.current.remove(),e.pointerMoveHandle.current=null,e.clearGraphics()),e.pointerLeaveHandle.current&&(e.pointerLeaveHandle.current.remove(),e.pointerLeaveHandle.current=null),null!==e.rafId.current&&(cancelAnimationFrame(e.rafId.current),e.rafId.current=null)},setupCursorTracking:e=>{const{view:t,widgetId:r,ensureGraphicsLayer:o,cachedLayerRef:n,pointerMoveHandleRef:a,pointerLeaveHandleRef:l,rafIdRef:i,lastCursorPointRef:s,pendingMapPointRef:u,lastHoverQueryPointRef:c,updateCursorPoint:p,throttledHoverQuery:d,cleanupHoverQuery:f}=e;o(t),n.current=t.map.findLayerById(`property-${r}-highlight-layer`),a.current=t.on("pointer-move",(e=>{const r={x:e.x,y:e.y},o=t.toMap(r);if(!o)return s.current=null,u.current=null,p(null),void f();s.current=o,u.current=o,null===i.current&&(i.current=requestAnimationFrame((()=>{i.current=null;const e=u.current;e&&p(e)}))),d(o,r)})),l.current=t.on("pointer-leave",(()=>{s.current=null,u.current=null,c.current=null,null!==i.current&&(cancelAnimationFrame(i.current),i.current=null),p(null),f()}))},resetCursorState:e=>{e.lastCursorPointRef.current=null,e.pendingMapPointRef.current=null,e.cachedLayerRef.current=null,e.clearGraphics(),e.cleanupQuery()},teardownCursorTracking:e=>{null!==e.rafId.current&&(cancelAnimationFrame(e.rafId.current),e.rafId.current=null),e.pointerMoveHandle.current&&(e.pointerMoveHandle.current.remove(),e.pointerMoveHandle.current=null),e.pointerLeaveHandle.current&&(e.pointerLeaveHandle.current.remove(),e.pointerLeaveHandle.current=null),e.cleanupQuery(),e.pendingMapPointRef.current=null,e.cachedLayerRef.current=null,e.canTrackCursor||(e.lastCursorPointRef.current=null),e.clearGraphics()}}},9244:e=>{"use strict";e.exports=r},9298:e=>{"use strict";e.exports=a},9935:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik03LjUgMEM3LjIyMzg2IDAgNyAwLjIyMzg1OCA3IDAuNVY3SDAuNUMwLjIyMzg1OCA3IDAgNy4yMjM4NiAwIDcuNUMwIDcuNzc2MTQgMC4yMjM4NTggOCAwLjUgOEg3VjE0LjVDNyAxNC43NzYxIDcuMjIzODYgMTUgNy41IDE1QzcuNzc2MTQgMTUgOCAxNC43NzYxIDggMTQuNVY4SDE0LjVDMTQuNzc2MSA4IDE1IDcuNzc2MTQgMTUgNy41QzE1IDcuMjIzODYgMTQuNzc2MSA3IDE0LjUgN0g4VjAuNUM4IDAuMjIzODU4IDcuNzc2MTQgMCA3LjUgMFoiIGZpbGw9ImJsYWNrIi8+DQo8L3N2Zz4NCg=="}},t={};function u(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,u),n.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{__set_webpack_public_path__:()=>x,default:()=>T});var e=u(9244),t=u(4321),r=u(4337),o=u(9298),n=u(3089);const a={configurationInstructions:"Configure the widget by providing layer URLs and display preferences.",mapWidgetTitle:"Map connection",mapWidgetDescription:"Link the map widget that triggers parcel lookups.",dataSourcesDescription:"Ensure property and owner layers share matching FNR fields.",propertyDataSourceLabel:"Property layer",propertyDataSourceDescription:"Parcel layer containing geometry and FNR values.",ownerDataSourceLabel:"Owner layer",ownerDataSourceDescription:"Owner layer or table with NAMN and BOSTADR details.",displayOptionsTitle:"Display options",panelDisplaySettings:"Display behavior",advancedSettingsTitle:"Advanced settings",panelHighlightSettings:"Highlight styling",highlightColorLabelTooltip:"Set highlight color for parcels.",highlightOpacityLabelTooltip:"Set fill opacity for highlighted parcels.",maxResultsLabel:"Maximum results",maxResultsDescription:"Limit parcel queries to protect performance.",resetMaxResults:"Reset to default",enableToggleRemovalLabel:"Toggle removal",enableToggleRemovalDescription:"Let users click a parcel again to clear it.",enablePIIMaskingLabel:"PII masking",enablePIIMaskingDescription:"Mask names and addresses inside the widget.",highlightOptionsDescription:"Adjust how selected parcels appear on the map.",highlightColorLabel:"Highlight color",highlightOpacityLabel:"Fill opacity",highlightOutlineWidthLabel:"Outline width",highlightOutlineWidthLabelTooltip:"Set the outline width for highlighted parcels.",allowedHostsLabel:"Allowed hosts",allowedHostsDescription:"Whitelist HTTPS hosts that should pass URL checks.",allowedHostsPlaceholder:"lund.se",addAllowedHostLabel:"Add allowed host",allowedHostsListLabel:"Allowed host entries",allowedHostsEmptyHint:"No allowed hosts yet.",removeAllowedHostLabel:"Remove allowed host",enableBatchOwnerQueryLabel:"Batch owner queries",enableBatchOwnerQueryDescription:"Use a relationship to fetch all owners in one request.",relationshipIdLabel:"Relationship ID",relationshipIdDescription:"Relationship ID that links parcels to owner records.",relationshipIdPlaceholder:"e.g., 0, 1, 2",relationshipIdTooltip:"Open /MapServer/[layerId]?f=json to list relationship IDs.",errorInvalidUrl:"Enter a valid ArcGIS REST service URL.",errorInvalidNumber:"Enter a whole number greater than zero.",errorMaxResultsInvalid:"Max results must be between 1 and 1000.",errorRelationshipIdInvalid:"Relationship ID must be between 0 and 99.",runtimeStateQuerying:"Query in progress...",runtimeStateError:"Query error occurred. Check widget for details.",runtimeStateSelected:"{count} properties currently selected",fbwebbSettings:"FBWebb report URL settings",fbwebbBaseUrlLabel:"FBWebb base URL",fbwebbBaseUrlDescription:"HTTPS endpoint for FBWebb property reports.",fbwebbUserLabel:"User",fbwebbUserDescription:"FBWebb username for report access.",fbwebbPasswordLabel:"Password",fbwebbPasswordDescription:"FBWebb password stored within the widget configuration.",fbwebbDatabaseLabel:"Database",fbwebbDatabaseDescription:"FBWebb database name (for example, Lund).",fbwebbConfiguredMessage:"FBWebb URL generation is enabled.",errorUrlMustBeHttps:"Enter a valid HTTPS URL."};var l=u(1528),i=u(1888);const s=(t,r={})=>(0,e.css)(Object.assign({display:"flex",flexFlow:`${t} nowrap`},r)),p=()=>(t=>{var r,o;const n=t.sys.spacing,a=t.sys.typography;return{row:(0,e.css)({width:"100%",margin:"16px 0 !important"}),fullWidth:s("column",{inlineSize:"100%",flex:"1 1 auto",minInlineSize:0}),labelWithTooltip:s("row",{alignItems:"center",gap:null==n?void 0:n(1)}),tooltipTrigger:(0,e.css)({margin:"0 !important",padding:"0 !important",opacity:.6,"&:hover":{opacity:1}}),description:(0,e.css)({fontSize:null===(r=null==a?void 0:a.body2)||void 0===r?void 0:r.fontSize,marginBlockStart:null==n?void 0:n(1)}),sliderWrap:s("column",{inlineSize:"100%"}),sliderTrack:s("row",{alignItems:"center",inlineSize:"100%",gap:null==n?void 0:n(2)}),sliderControl:(0,e.css)({flex:"1 1 auto",inlineSize:"100%"}),sliderValue:(0,e.css)({textAlign:"right",fontSize:null===(o=null==a?void 0:a.label2)||void 0===o?void 0:o.fontSize}),allowedHostInputRow:s("row",{inlineSize:"100%",alignItems:"center"}),allowedHostInput:(0,e.css)({flex:"1 1 auto",inlineSize:"100%",minInlineSize:0}),allowedHostList:s("column",{inlineSize:"100%",".input-wrapper":{background:"transparent !important",borderColor:"rgb(106, 106, 106) !important"},"&.disabled .input-wrapper, &.readonly .input-wrapper":{background:"transparent !important",borderColor:"rgb(106, 106, 106) !important",opacity:1,color:"rgb(168, 168, 168)",WebkitTextFillColor:"rgb(168, 168, 168)"}}),addAllowedHostButton:(0,e.css)({border:"none !important"}),allowedHostListRow:s("row",{inlineSize:"100%",alignItems:"center"}),allowedHostListInput:(0,e.css)({flex:"1 1 auto",inlineSize:"100%",minInlineSize:0})}})((0,i.useTheme)());u(2686),u(2796);var d=u(8491);const f=e=>"object"==typeof e&&null!==e,g=(t,r,o,n)=>{const a=e.hooks.useLatest(t);return e.hooks.useEventCallback((e=>{const t=e.target.checked;t!==a.current&&(r(t),o(n,t))}))},h=(t,r,o,n,a)=>e.hooks.useEventCallback((e=>{var l,i;const s=Number.parseFloat(null!==(i=null===(l=null==e?void 0:e.target)||void 0===l?void 0:l.value)&&void 0!==i?i:"");if(!Number.isFinite(s))return;const u=a(s);Math.abs(t-u)<1e-4||(r(u),o(n,u))})),b=t=>{const{localValue:r,setLocalValue:o,validate:n,updateConfig:a,configField:l,clamp:i,debounce:s}=t,u=w(n,null!=s?s:0),c=e.hooks.useLatest(a);return{handleChange:e.hooks.useEventCallback((e=>{const t=i?Math.max(i.min,Math.min(i.max,Math.round(e))):Math.round(e);o(String(t)),s&&u(String(t))})),handleBlur:e.hooks.useEventCallback((()=>{s&&u.cancel();if(n(r)){const e=parseInt(r,10);c.current(l,e)}}))}},y=(t,r,o,n,a)=>e.hooks.useEventCallback((e=>{const{validateNumericRange:l}=u(8491),i=l({value:e,min:r,max:o,errorMessage:n});return a((e=>Object.assign(Object.assign({},e),{[t]:i.valid?void 0:i.error}))),i.valid})),w=(t,r,o)=>{const n=Number.isFinite(r)&&r>=0?r:0,a=e.React.useRef(null),l=e.React.useRef(!1),i=e.React.useRef(!0),s=e.hooks.useLatest(t),u=e.hooks.useLatest(o),c=e.hooks.useEventCallback((e=>{var t;if(l.current===e)return;l.current=e;const r=null===(t=u.current)||void 0===t?void 0:t.onPendingChange;if("function"==typeof r)try{r(e)}catch(e){d.logger.debug("onPendingChange callback failed",{error:e})}})),p=e.hooks.useEventCallback((()=>{a.current&&(clearTimeout(a.current),a.current=null),l.current&&c(!1)})),f=e.hooks.useEventCallback(((...e)=>{a.current&&clearTimeout(a.current),c(!0),a.current=setTimeout((()=>{if(a.current=null,i.current)try{s.current(...e)}finally{c(!1)}}),n)})),g=e.React.useRef(null),h=e.hooks.useLatest(f),b=e.hooks.useLatest(p);if(!g.current){const e=(...e)=>{h.current(...e)};e.cancel=()=>b.current(),g.current=e}return e.hooks.useEffectOnce((()=>()=>{i.current=!1,b.current()})),g.current};var v=u(9935),m=u.n(v),I=u(1601),S=u.n(I),D=u(7519),M=u.n(D),R=u(844);function A(t){return(0,e.Immutable)(t)}const T=i=>{var s,u,c,w;const{config:v,id:I,onSettingChange:D,useMapWidgetIds:T}=i,x=e.hooks.useTranslation(t.defaultMessages,a),E=p(),j=e.React.useRef((0,R.createPropertySelectors)(I)).current,N=e.ReactRedux.useSelector(j.selectSelectedProperties),O=e.ReactRedux.useSelector(j.selectIsQueryInFlight),L=null!==e.ReactRedux.useSelector(j.selectError),C=Array.isArray(N)?N.length:0,k=(r,o)=>{const n=x(r),a=x(o);return(0,e.jsx)("div",{css:E.labelWithTooltip},(0,e.jsx)("span",null,n),(0,e.jsx)(t.Tooltip,{title:a,placement:"top",showArrow:!0},(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,"aria-label":a,css:E.tooltipTrigger},(0,e.jsx)(t.SVG,{src:M()}))))},P=e=>{var t,r;if(!e)return[];if(Array.isArray(e))return e.slice();if((r=e)&&"object"==typeof r&&"function"==typeof r.asMutable){const r=null===(t=e.asMutable)||void 0===t?void 0:t.call(e,{deep:!0});return Array.isArray(r)?r:[]}return[]},U=e=>{if(!e||!i.useDataSources)return A([]);return A(P(i.useDataSources).filter((t=>(null==t?void 0:t.dataSourceId)===e)))},H=(t=>{const r=e.hooks.useLatest(t);return e.hooks.useEventCallback(((e,t=!1)=>{const o=r.current;if(o&&f(o)){const t=o[e];if("boolean"==typeof t)return t}return t}))})(v),z=((t,r,o)=>{const n=e.hooks.useLatest(r);return e.hooks.useEventCallback(((e,r)=>{const a=n.current;let l;l=(e=>!(!e||"object"!=typeof e)&&"function"==typeof e.set)(a)?a.set(e,r):f(a)?Object.assign(Object.assign({},a),{[e]:r}):{[e]:r},o({id:t,config:l})}))})(I,v,D),[W,F]=e.React.useState((()=>String(v.maxResults||50))),[_,B]=e.React.useState((()=>H("enableToggleRemoval"))),[Q,G]=e.React.useState((()=>H("enablePIIMasking"))),[Y,V]=e.React.useState((()=>H("enableBatchOwnerQuery",!1))),[$,Z]=e.React.useState((()=>{var e;return String(null!==(e=v.relationshipId)&&void 0!==e?e:0)})),[J,q]=e.React.useState(""),[X,K]=e.React.useState((()=>(0,d.normalizeHostList)(v.allowedHosts))),[ee,te]=e.React.useState(v.highlightColor),[re,oe]=e.React.useState((()=>{const e="number"==typeof v.highlightOpacity?v.highlightOpacity:.4;return d.opacityHelpers.fromPercent(d.opacityHelpers.toPercent(e))})),[ne,ae]=e.React.useState((()=>{const e=v.outlineWidth;return"number"==typeof e&&Number.isFinite(e)?e:1})),[le,ie]=e.React.useState(null!==(s=v.fbwebbBaseUrl)&&void 0!==s?s:""),[se,ue]=e.React.useState(null!==(u=v.fbwebbUser)&&void 0!==u?u:""),[ce,pe]=e.React.useState(null!==(c=v.fbwebbPassword)&&void 0!==c?c:""),[de,fe]=e.React.useState(null!==(w=v.fbwebbDatabase)&&void 0!==w?w:""),[ge,he]=e.React.useState({}),be=y("maxResults",1,1e3,x("errorMaxResultsInvalid"),he),ye=y("relationshipId",0,99,x("errorRelationshipIdInvalid"),he),{handleChange:we,handleBlur:ve}=b({localValue:W,setLocalValue:F,validate:be,updateConfig:z,configField:"maxResults",debounce:500}),{handleChange:me,handleBlur:Ie}=b({localValue:$,setLocalValue:Z,validate:ye,updateConfig:z,configField:"relationshipId",clamp:{min:0,max:99}}),Se=g(_,B,z,"enableToggleRemoval"),De=g(Q,G,z,"enablePIIMasking"),Me=g(Y,V,z,"enableBatchOwnerQuery"),Re=e.hooks.useEventCallback((e=>{q(e.target.value)})),Ae=e.hooks.useEventCallback((()=>{const e=(0,d.normalizeHostValue)(J);if(!e)return void q("");if(X.includes(e))return;const t=[...X,e];K(t),z("allowedHosts",t),q("")})),Te=e.hooks.useEventCallback((e=>{const t=(0,d.normalizeHostValue)(e),r=X.filter((e=>e!==t));r.length!==X.length&&(K(r),z("allowedHosts",r))})),xe=e.hooks.useEventCallback((e=>{"Enter"===e.key&&(e.preventDefault(),tt&&Ae())})),Ee=e.hooks.useEventCallback((e=>{const t=e.target.value;if(ie(t),!t)return void he((e=>Object.assign(Object.assign({},e),{fbwebbBaseUrl:void 0})));const r=(0,d.isValidFbwebbBaseUrl)(t);he((e=>Object.assign(Object.assign({},e),{fbwebbBaseUrl:r?void 0:x("errorUrlMustBeHttps")})))})),je=e.hooks.useEventCallback((()=>{const e=le.trim();e&&!(0,d.isValidFbwebbBaseUrl)(e)||(ie(e),z("fbwebbBaseUrl",e||void 0))})),Ne=e.hooks.useEventCallback((e=>{ue(e.target.value)})),Oe=e.hooks.useEventCallback((()=>{const e=se.trim();ue(e),z("fbwebbUser",e||void 0)})),Le=e.hooks.useEventCallback((e=>{pe(e.target.value)})),Ce=e.hooks.useEventCallback((()=>{z("fbwebbPassword",ce||void 0)})),ke=e.hooks.useEventCallback((e=>{fe(e.target.value)})),Pe=e.hooks.useEventCallback((()=>{const e=de.trim();fe(e),z("fbwebbDatabase",e||void 0)})),Ue=e.hooks.useEventCallback((e=>{const t=e||v.highlightColor;te(t),z("highlightColor",t)})),He=h(re,oe,z,"highlightOpacity",d.opacityHelpers.fromPercent),ze=h(ne,ae,z,"outlineWidth",d.outlineWidthHelpers.normalize),We=e.hooks.useEventCallback((e=>{var t,r,o;const n=null!==(t=null==e?void 0:e[0])&&void 0!==t?t:null,a=null!==(r=null==n?void 0:n.dataSourceId)&&void 0!==r?r:"",l=null!==(o=P(i.useDataSources).find((e=>(null==e?void 0:e.dataSourceId)===v.ownerDataSourceId)))&&void 0!==o?o:null,s=!!a&&!v.ownerDataSourceId||!!a&&v.ownerDataSourceId&&v.ownerDataSourceId===v.propertyDataSourceId,u=[];n&&u.push(n),l&&l.dataSourceId&&l.dataSourceId!==a&&!s&&u.push(l);const c=s?v.set("propertyDataSourceId",a).set("ownerDataSourceId",a):v.set("propertyDataSourceId",a);D({id:I,useDataSources:u,config:c})})),Fe=e.hooks.useEventCallback((e=>{var t,r,o;const n=null!==(t=null==e?void 0:e[0])&&void 0!==t?t:null,a=null!==(r=null==n?void 0:n.dataSourceId)&&void 0!==r?r:"";let l=null!==(o=P(i.useDataSources).find((e=>(null==e?void 0:e.dataSourceId)===v.propertyDataSourceId)))&&void 0!==o?o:null;!l&&v.propertyDataSourceId&&(l={dataSourceId:v.propertyDataSourceId,mainDataSourceId:v.propertyDataSourceId,rootDataSourceId:v.propertyDataSourceId});const s=[];l&&s.push(l);const u=!l||l.dataSourceId!==(null==n?void 0:n.dataSourceId);n&&u&&s.push(n);const c=v.set("ownerDataSourceId",a);D({id:I,useDataSources:s,config:c})})),_e=e.hooks.useEventCallback((e=>{D({id:I,useMapWidgetIds:e})}));e.hooks.useUpdateEffect((()=>{F(String(v.maxResults||50))}),[v.maxResults]),e.hooks.useUpdateEffect((()=>{B(H("enableToggleRemoval"))}),[v.enableToggleRemoval]),e.hooks.useUpdateEffect((()=>{G(H("enablePIIMasking"))}),[v.enablePIIMasking]),e.hooks.useUpdateEffect((()=>{V(H("enableBatchOwnerQuery",!1))}),[v.enableBatchOwnerQuery]),e.hooks.useUpdateEffect((()=>{var e;Z(String(null!==(e=v.relationshipId)&&void 0!==e?e:0))}),[v.relationshipId]),e.hooks.useUpdateEffect((()=>{const e=(0,d.normalizeHostList)(v.allowedHosts);K(e)}),[v.allowedHosts]),e.hooks.useUpdateEffect((()=>{te(v.highlightColor)}),[v.highlightColor]),e.hooks.useUpdateEffect((()=>{const e="number"==typeof v.highlightOpacity?v.highlightOpacity:.4;oe(d.opacityHelpers.fromPercent(d.opacityHelpers.toPercent(e)))}),[v.highlightOpacity]),e.hooks.useUpdateEffect((()=>{const e="number"==typeof v.outlineWidth?v.outlineWidth:1;ae(d.outlineWidthHelpers.normalize(e))}),[v.outlineWidth]),e.hooks.useUpdateEffect((()=>{var e;ie(null!==(e=v.fbwebbBaseUrl)&&void 0!==e?e:"")}),[v.fbwebbBaseUrl]),e.hooks.useUpdateEffect((()=>{var e;ue(null!==(e=v.fbwebbUser)&&void 0!==e?e:"")}),[v.fbwebbUser]),e.hooks.useUpdateEffect((()=>{var e;pe(null!==(e=v.fbwebbPassword)&&void 0!==e?e:"")}),[v.fbwebbPassword]),e.hooks.useUpdateEffect((()=>{var e;fe(null!==(e=v.fbwebbDatabase)&&void 0!==e?e:"")}),[v.fbwebbDatabase]),e.hooks.useEffectOnce((()=>{}));const Be=Array.isArray(T)&&T.length>0,Qe=Boolean(v.propertyDataSourceId),Ge=Boolean(v.ownerDataSourceId),Ye=Qe&&Ge,Ve=Be&&Ye,$e=Be&&Ye,Ze=!$e;e.hooks.useEffectWithPreviousValues((()=>{Ze&&(Y&&V(!1),v.enableBatchOwnerQuery&&z("enableBatchOwnerQuery",!1),void 0!==v.relationshipId&&z("relationshipId",void 0),"0"!==$&&Z("0"),he((e=>Object.assign(Object.assign({},e),{relationshipId:void 0}))))}),[Ze,Y,v.enableBatchOwnerQuery,v.relationshipId,$,z]);const Je=d.opacityHelpers.toPercent(re),qe=d.opacityHelpers.formatPercent(Je),Xe=d.outlineWidthHelpers.normalize(ne),Ke=d.outlineWidthHelpers.formatDisplay(ne),et=(0,d.normalizeHostValue)(J),tt=et.length>0&&!X.includes(et),rt=U(v.propertyDataSourceId),ot=U(v.ownerDataSourceId);return(0,e.jsx)(e.React.Fragment,null,(C>0||O||L)&&(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row},(0,e.jsx)(t.Alert,{fullWidth:!0,css:E.fullWidth,type:O?"info":L?"warning":"success",text:O?x("runtimeStateQuerying"):L?x("runtimeStateError"):x("runtimeStateSelected").replace("{count}",String(C)),closable:!1}))),(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("mapWidgetTitle","mapWidgetDescription")},(0,e.jsx)(o.MapWidgetSelector,{onSelect:_e,useMapWidgetIds:T}))),(0,e.jsx)(o.SettingSection,null,Be&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("propertyDataSourceLabel","propertyDataSourceDescription")},(0,e.jsx)(n.DataSourceSelector,{types:A([e.DataSourceTypes.FeatureLayer]),useDataSources:rt,mustUseDataSource:!0,onChange:We,widgetId:I,hideTypeDropdown:!0})),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("ownerDataSourceLabel","ownerDataSourceDescription")},(0,e.jsx)(n.DataSourceSelector,{types:A([e.DataSourceTypes.FeatureLayer]),useDataSources:ot,mustUseDataSource:!0,onChange:Fe,widgetId:I,hideTypeDropdown:!0})),!Ye&&(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row},(0,e.jsx)(t.Alert,{fullWidth:!0,css:E.fullWidth,type:"warning",text:x("dataSourcesDescription"),closable:!1})))),Ve&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:x("panelDisplaySettings"),type:"default",level:1,role:"group","aria-label":x("panelDisplaySettings")},(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("maxResultsLabel","maxResultsDescription")},(0,e.jsx)(t.NumericInput,{css:E.fullWidth,value:parseInt(W,10),min:1,max:1e3,onChange:we,onBlur:ve,"aria-label":x("maxResultsLabel"),"aria-invalid":!!ge.maxResults})),ge.maxResults&&(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row},(0,e.jsx)(t.Alert,{fullWidth:!0,css:E.fullWidth,type:"error",text:ge.maxResults,closable:!1})),(0,e.jsx)(o.SettingRow,{flow:"no-wrap",level:1,css:E.row,label:k("enableToggleRemovalLabel","enableToggleRemovalDescription")},(0,e.jsx)(t.Switch,{checked:_,onChange:Se,"aria-label":x("enableToggleRemovalLabel")})),(0,e.jsx)(o.SettingRow,{flow:"no-wrap",level:1,css:E.row,label:k("enablePIIMaskingLabel","enablePIIMaskingDescription")},(0,e.jsx)(t.Switch,{checked:Q,onChange:De,"aria-label":x("enablePIIMaskingLabel")})),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("allowedHostsLabel","allowedHostsDescription")},(0,e.jsx)("div",{css:E.allowedHostInputRow},(0,e.jsx)(t.TextInput,{css:E.allowedHostInput,value:J,onChange:Re,onKeyDown:xe,placeholder:x("allowedHostsPlaceholder"),"aria-label":x("allowedHostsLabel"),spellCheck:!1}),(0,e.jsx)(t.Button,{type:"default",icon:!0,onClick:Ae,title:x("addAllowedHostLabel"),"aria-label":x("addAllowedHostLabel"),disabled:!tt,css:E.addAllowedHostButton},(0,e.jsx)(t.SVG,{src:m(),size:16})))),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row},(0,e.jsx)("div",{css:E.allowedHostList},X.length>0?X.map((r=>(0,e.jsx)("div",{css:E.allowedHostListRow,key:r},(0,e.jsx)(t.TextInput,{css:E.allowedHostListInput,value:r,readOnly:!0,borderless:!0,disabled:!0,spellCheck:!1,"aria-label":`${x("allowedHostsListLabel")}: ${r}`}),(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,onClick:()=>Te(r),title:x("removeAllowedHostLabel"),"aria-label":x("removeAllowedHostLabel")},(0,e.jsx)(t.SVG,{src:S(),size:16}))))):(0,e.jsx)("div",{css:E.description,role:"status","aria-live":"polite"},x("allowedHostsEmptyHint")))))),(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:x("panelHighlightSettings"),type:"default",level:1,role:"group","aria-label":x("panelHighlightSettings")},(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("highlightColorLabel","highlightColorLabelTooltip")},(0,e.jsx)(r.ColorPicker,{css:E.fullWidth,color:ee,onChange:Ue,"aria-label":x("highlightColorLabel")})),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("highlightOpacityLabel","highlightOpacityLabelTooltip")},(0,e.jsx)("div",{css:E.sliderWrap},(0,e.jsx)("div",{css:E.sliderTrack},(0,e.jsx)(t.Slider,{value:Je,min:0,max:100,step:5,tooltip:!0,formatter:d.opacityHelpers.formatPercent,"aria-label":x("highlightOpacityLabel"),onChange:He,css:E.sliderControl}),(0,e.jsx)("div",{css:E.sliderValue,role:"status","aria-live":"polite"},qe)))),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("highlightOutlineWidthLabel","highlightOutlineWidthLabelTooltip")},(0,e.jsx)("div",{css:E.sliderWrap},(0,e.jsx)("div",{css:E.sliderTrack},(0,e.jsx)(t.Slider,{value:Xe,min:.5,max:10,step:.5,tooltip:!0,formatter:d.outlineWidthHelpers.formatDisplay,"aria-label":x("highlightOutlineWidthLabel"),onChange:ze,css:E.sliderControl}),(0,e.jsx)("div",{css:E.sliderValue,role:"status","aria-live":"polite"},Ke)))))),(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:x("fbwebbSettings"),type:"default",level:1,role:"group","aria-label":x("fbwebbSettings")},(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("fbwebbBaseUrlLabel","fbwebbBaseUrlDescription")},(0,e.jsx)(t.TextInput,{css:E.fullWidth,value:le,onChange:Ee,onBlur:je,placeholder:"https://","aria-label":x("fbwebbBaseUrlLabel"),"aria-invalid":!!ge.fbwebbBaseUrl,spellCheck:!1})),ge.fbwebbBaseUrl&&(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row},(0,e.jsx)(t.Alert,{fullWidth:!0,css:E.fullWidth,type:"error",text:ge.fbwebbBaseUrl,closable:!1})),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("fbwebbUserLabel","fbwebbUserDescription")},(0,e.jsx)(t.TextInput,{css:E.fullWidth,value:se,onChange:Ne,onBlur:Oe,placeholder:"","aria-label":x("fbwebbUserLabel"),spellCheck:!1})),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("fbwebbPasswordLabel","fbwebbPasswordDescription")},(0,e.jsx)(t.TextInput,{css:E.fullWidth,type:"password",value:ce,onChange:Le,onBlur:Ce,"aria-label":x("fbwebbPasswordLabel"),autoComplete:"off"})),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("fbwebbDatabaseLabel","fbwebbDatabaseDescription")},(0,e.jsx)(t.TextInput,{css:E.fullWidth,value:de,onChange:ke,onBlur:Pe,placeholder:"","aria-label":x("fbwebbDatabaseLabel"),spellCheck:!1})),(0,l.Lt)(v)&&(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row},(0,e.jsx)(t.Alert,{fullWidth:!0,css:E.fullWidth,type:"info",text:x("fbwebbConfiguredMessage"),closable:!1}))))),$e&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:x("advancedSettingsTitle"),type:"default",level:1,role:"group","aria-label":x("advancedSettingsTitle")},(0,e.jsx)(o.SettingRow,{flow:"no-wrap",level:1,css:E.row,label:k("enableBatchOwnerQueryLabel","enableBatchOwnerQueryDescription")},(0,e.jsx)(t.Switch,{checked:Y,onChange:Me,"aria-label":x("enableBatchOwnerQueryLabel")})),Y&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row,label:k("relationshipIdLabel","relationshipIdDescription")},(0,e.jsx)(t.NumericInput,{css:E.fullWidth,value:parseInt($,10),min:0,max:99,onChange:me,onBlur:Ie,"aria-label":x("relationshipIdLabel"),title:x("relationshipIdTooltip"),"aria-invalid":!!ge.relationshipId})),ge.relationshipId&&(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:E.row},(0,e.jsx)(t.Alert,{fullWidth:!0,css:E.fullWidth,type:"error",text:ge.relationshipId,closable:!1})))))))};function x(e){u.p=e}})(),c})())}}}));