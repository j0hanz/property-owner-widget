System.register(["jimu-core","jimu-ui","jimu-ui/basic/color-picker","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-theme","jimu-arcgis"],(function(e,t){var o={},r={},l={},n={},a={},i={},s={};return{setters:[function(e){o.DataSourceTypes=e.DataSourceTypes,o.Immutable=e.Immutable,o.React=e.React,o.css=e.css,o.hooks=e.hooks,o.jsx=e.jsx},function(e){r.Alert=e.Alert,r.Button=e.Button,r.CollapsablePanel=e.CollapsablePanel,r.NumericInput=e.NumericInput,r.SVG=e.SVG,r.Slider=e.Slider,r.Switch=e.Switch,r.TextInput=e.TextInput,r.Tooltip=e.Tooltip,r.defaultMessages=e.defaultMessages},function(e){l.ColorPicker=e.ColorPicker},function(e){n.MapWidgetSelector=e.MapWidgetSelector,n.SettingRow=e.SettingRow,n.SettingSection=e.SettingSection},function(e){a.DataSourceSelector=e.DataSourceSelector},function(e){i.useTheme=e.useTheme},function(e){s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={1528:(e,t,o)=>{"use strict";function r(e){return e.valid}function l(e){return!e.valid}o.d(t,{j:()=>r,k:()=>l})},1601:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik04Ljc0NTQ4IDhMMTQuODQ1NiAxNC4xMDAxQzE1LjA1MTUgMTQuMzA2IDE1LjA1MTUgMTQuNjM5NyAxNC44NDU2IDE0Ljg0NTZDMTQuNjM5NyAxNS4wNTE1IDE0LjMwNiAxNS4wNTE1IDE0LjEwMDEgMTQuODQ1Nkw4IDguNzQ1NDhMMS44OTk4NyAxNC44NDU2QzEuNjk0MDEgMTUuMDUxNSAxLjM2MDI1IDE1LjA1MTUgMS4xNTQzOSAxNC44NDU2QzAuOTQ4NTM2IDE0LjYzOTcgMC45NDg1MzYgMTQuMzA2IDEuMTU0MzkgMTQuMTAwMUw3LjI1NDUyIDhMMS4xNTQzOSAxLjg5OTg3QzAuOTQ4NTM1IDEuNjk0MDEgMC45NDg1MzUgMS4zNjAyNSAxLjE1NDM5IDEuMTU0MzlDMS4zNjAyNSAwLjk0ODUzNiAxLjY5NDAxIDAuOTQ4NTM2IDEuODk5ODcgMS4xNTQzOUw4IDcuMjU0NTJMMTQuMTAwMSAxLjE1NDM5QzE0LjMwNiAwLjk0ODUzNSAxNC42Mzk3IDAuOTQ4NTM1IDE0Ljg0NTYgMS4xNTQzOUMxNS4wNTE1IDEuMzYwMjUgMTUuMDUxNSAxLjY5NDAxIDE0Ljg0NTYgMS44OTk4N0w4Ljc0NTQ4IDhaIiBmaWxsPSJibGFjayIvPg0KPC9zdmc+DQo="},1888:e=>{"use strict";e.exports=i},2686:e=>{"use strict";e.exports=s},2796:(e,t,o)=>{"use strict";o.d(t,{Dj:()=>c,Nb:()=>s,PP:()=>n,Sh:()=>i,Tq:()=>a,Ye:()=>u,nV:()=>r,qC:()=>l});const r=3,l=3,n="#b54900",a=.5,i=1,s=5,u=12,c={textColor:"#000000",backgroundColor:"#ffffffe0",fontFamily:"sans-serif",fontSize:10,fontWeight:"normal",verticalAlignment:"top",horizontalAlignment:"center",yoffset:28,xoffset:0,lineWidth:192,lineHeight:1,kerning:!0}},3089:e=>{"use strict";e.exports=a},4321:e=>{"use strict";e.exports=r},4337:e=>{"use strict";e.exports=l},6250:(e,t,o)=>{"use strict";o.d(t,{PM:()=>h,XW:()=>w,nS:()=>y});var r=o(2686),l=o(1528),n=o(8491),a=(o(2796),function(e,t,o,r){return new(o||(o=Promise))((function(l,n){function a(e){try{s(r.next(e))}catch(e){n(e)}}function i(e){try{s(r.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}s((r=r.apply(e,t||[])).next())}))});new Map;const i=e=>e?{signal:e}:void 0;let s=null,u=null;const c=new Map;const d=(e,t,o)=>({valid:!1,error:{type:e,message:t},failureReason:o}),p=(e,t,o,r)=>{const l=(0,n.normalizeHostList)(o),a=(e=>{var t,o,r,l,n;if(!e)return null;const a=null===(o=null===(t=e.getLayerDefinition)||void 0===t?void 0:t.call(e))||void 0===o?void 0:o.url;if(a)return a;return(null===(l=null===(r=e.getDataSourceJson)||void 0===r?void 0:r.call(e))||void 0===l?void 0:l.url)||(null==e?void 0:e.url)||(null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.url)||null})(e);return a&&((e,t)=>{try{const r=new URL(e);return!(e=>{const t=e.toLowerCase();return"localhost"===t||"127.0.0.1"===t||"::1"===t||"[::1]"===t||/^10\./.test(t)||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(t)||/^192\.168\./.test(t)})(r.hostname)&&(e=>"https:"===e.protocol&&(""===e.port||"443"===e.port))(r)&&!((o=r.pathname).length>500)&&/\/(MapServer|FeatureServer)\/\d+(\/query)?$/.test(o)&&((e,t)=>!t||0===t.length||t.some((t=>{if(e===t)return!0;const o=`.${t}`;return e.endsWith(o)})))(r.hostname,t)}catch(e){return!1}var o})(a,l)?{valid:!0,data:null}:d("VALIDATION_ERROR",r("errorHostNotAllowed"),`${t}_disallowed_host`)},g=(e,t,o)=>e?(e=>null!==e&&"function"==typeof e.query)(e)?{valid:!0,data:null}:d("VALIDATION_ERROR",o("errorNoDataAvailable"),`${t}_ds_not_queryable`):d("VALIDATION_ERROR",o("errorNoDataAvailable"),`${t}_ds_not_found`),h=e=>{const{propertyDsId:t,ownerDsId:o,dsManager:r,allowedHosts:n,translate:a}=e;if(!t||!o)return d("VALIDATION_ERROR",a("errorNoDataAvailable"),"missing_data_sources");if(!r)return d("QUERY_ERROR",a("errorQueryFailed"),"no_data_source_manager");const i=r.getDataSource(t),s=r.getDataSource(o),u=g(i,"property",a);if((0,l.k)(u))return u;const c=g(s,"owner",a);if((0,l.k)(c))return c;if(!i||!s)return d("VALIDATION_ERROR",a("errorNoDataAvailable"),"missing_data_source_instance");const h=p(i,"property",n,a);if((0,l.k)(h))return h;const w=p(s,"owner",n,a);return(0,l.k)(w)?w:{valid:!0,data:{manager:r}}},w=(e,t,o,l)=>a(void 0,void 0,void 0,(function*(){try{n.abortHelpers.throwIfAborted(null==l?void 0:l.signal);const a=o.getDataSource(t);if(!a)throw new Error("Property data source not found");const d=a.url;if(!d)throw new Error("Data source URL not available");if(!s||!u){const[e,t]=yield(0,r.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer","esri/rest/support/Query"]);s=e,u=t}const p=s,g=u;if(!p||!g)throw new Error("Property query modules failed to load");let h=c.get(d);h||(h=new p({url:d}),c.set(d,h));const w=new g({geometry:e,returnGeometry:!0,outFields:["*"],spatialRelationship:"intersects"}),y=yield h.queryFeatures(w,i(null==l?void 0:l.signal));if(n.abortHelpers.throwIfAborted(null==l?void 0:l.signal),!(null==y?void 0:y.features)||0===y.features.length)return[];const I=y.features.map((e=>({features:[e],propertyId:e.attributes.FNR})));return n.logger.debug("Mapped results",{count:I.length,propertyIds:I.map((e=>e.propertyId))}),I}catch(e){if((0,n.isAbortError)(e))throw e;throw new Error((0,n.parseArcGISError)(e,"Property query failed"))}})),y=(e,t,o,r)=>a(void 0,void 0,void 0,(function*(){var l,a,s,u,c,d;try{n.abortHelpers.throwIfAborted(null==r?void 0:r.signal);const p=o.getDataSource(t);if(!p)throw new Error("Owner data source not found");const g=p.url,h=null===(a=(l=p).getLayerDefinition)||void 0===a?void 0:a.call(l);n.logger.debug("Querying owner layer",{dataSourceId:t,url:g,fnr:e,whereClause:(0,n.buildFnrWhereClause)(e),layerName:(null==h?void 0:h.name)||"unknown",layerFields:(null===(s=null==h?void 0:h.fields)||void 0===s?void 0:s.map((e=>e.name)))||[]});const w=yield p.query({where:(0,n.buildFnrWhereClause)(e),returnGeometry:!1,outFields:["*"]},i(null==r?void 0:r.signal));return n.logger.debug("Owner query result",{fnr:e,recordCount:(null===(u=null==w?void 0:w.records)||void 0===u?void 0:u.length)||0,hasRecords:!!((null==w?void 0:w.records)&&w.records.length>0),firstRecord:null===(d=null===(c=null==w?void 0:w.records)||void 0===c?void 0:c[0])||void 0===d?void 0:d.getData()}),n.abortHelpers.throwIfAborted(null==r?void 0:r.signal),(null==w?void 0:w.records)?(0===w.records.length&&n.logger.warn("Owner query returned empty records array",{fnr:e,dataSourceId:t,url:g,possibleCause:"No owner data for this FNR or querying wrong layer"}),w.records.map((t=>{const o=t.getData(),r={attributes:o};return n.logger.debug("Owner record processed",{fnrLength:String(e).length,hasNameField:"string"==typeof(null==o?void 0:o.NAMN)&&o.NAMN.length>0,hasAddressField:"string"==typeof(null==o?void 0:o.BOSTADR)&&o.BOSTADR.length>0,hasOwnerList:"string"==typeof(null==o?void 0:o.AGARLISTA)}),r}))):(n.logger.warn("Owner query returned no records",{fnr:e,dataSourceId:t,url:g,possibleCause:"FNR not found in owner layer or wrong layer configured"}),[])}catch(e){throw n.abortHelpers.handleOrThrow(e),new Error((0,n.parseArcGISError)(e,"Owner query failed"))}}))},7519:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCINCiAgICAgICAgZD0iTTE1IDhDMTUgMTEuODY2IDExLjg2NiAxNSA4IDE1QzQuMTM0MDEgMTUgMSAxMS44NjYgMSA4QzEgNC4xMzQwMSA0LjEzNDAxIDEgOCAxQzExLjg2NiAxIDE1IDQuMTM0MDEgMTUgOFpNMTYgOEMxNiAxMi40MTgzIDEyLjQxODMgMTYgOCAxNkMzLjU4MTcyIDE2IDAgMTIuNDE4MyAwIDhDMCAzLjU4MTcyIDMuNTgxNzIgMCA4IDBDMTIuNDE4MyAwIDE2IDMuNTgxNzIgMTYgOFpNOC4zMjQwNiAxMC4yMjhINy4zNDAwNkM3LjEyNzQ1IDkuMDg5NTIgNy45NjE0MSA4LjA5ODY4IDguNzE1MSA3LjIwMzIxQzkuMjgwMTQgNi41MzE4OCA5LjgwMDA2IDUuOTE0MTUgOS44MDAwNiA1LjMyOEM5LjgwMDA2IDQuNSA5LjIwMDA2IDMuOSA3Ljk3NjA2IDMuOUM3LjE2MDA2IDMuOSA2LjQwNDA2IDQuMjYgNS43MDgwNiA0Ljk5Mkw1LjA2MDA2IDQuMzkyQzUuODUyMDYgMy41NTIgNi43ODgwNiAzIDguMDk2MDYgM0M5Ljc4ODA2IDMgMTAuODY4MSAzLjg2NCAxMC44NjgxIDUuMjQ0QzEwLjg2ODEgNi4xMDgyIDEwLjIxNTcgNi44NzIzMiA5LjU2ODM3IDcuNjMwNTJDOC44NTg0NCA4LjQ2MjA2IDguMTU0NTggOS4yODY0OCA4LjMyNDA2IDEwLjIyOFpNOC42MjQwNiAxMi40QzguNjI0MDYgMTIuODggOC4yNzYwNiAxMy4xOTIgNy44NTYwNiAxMy4xOTJDNy40MjQwNiAxMy4xOTIgNy4wNzYwNiAxMi44OCA3LjA3NjA2IDEyLjRDNy4wNzYwNiAxMS45MiA3LjQyNDA2IDExLjU5NiA3Ljg1NjA2IDExLjU5NkM4LjI3NjA2IDExLjU5NiA4LjYyNDA2IDExLjkyIDguNjI0MDYgMTIuNFoiDQogICAgICAgIGZpbGw9ImJsYWNrIiAvPg0KPC9zdmc+"},8491:(e,t,o)=>{"use strict";o.r(t),o.d(t,{abortHelpers:()=>L,buildFnrWhereClause:()=>C,buildHighlightColor:()=>M,buildHighlightSymbolJSON:()=>N,buildTooltipSymbol:()=>I,calculatePropertyUpdates:()=>Q,cleanupRemovedGraphics:()=>z,computeWidgetsToClose:()=>Y,createRowId:()=>A,dataSourceHelpers:()=>te,executeHoverQuery:()=>V,extractFnr:()=>x,formatOwnerInfo:()=>b,formatPropertyWithShare:()=>v,getValidatedOutlineWidth:()=>O,isAbortError:()=>j,isDuplicateProperty:()=>H,isValidationFailure:()=>r.k,isValidationSuccess:()=>r.j,logger:()=>c,maskAddress:()=>h,maskName:()=>g,normalizeFnrKey:()=>T,normalizeHostList:()=>ee,normalizeHostValue:()=>K,numberHelpers:()=>R,opacityHelpers:()=>J,outlineWidthHelpers:()=>X,ownerIdentity:()=>y,ownerPrivacy:()=>p,ownerProcessing:()=>S,parseArcGISError:()=>k,popupSuppressionManager:()=>oe,processPropertyQueryResults:()=>W,shouldSkipHoverQuery:()=>_,shouldToggleRemove:()=>P,stripHtml:()=>u,syncCursorGraphics:()=>m,syncGraphicsWithState:()=>G,textSanitizer:()=>s,typeGuards:()=>E,updateGraphicSymbol:()=>$,updateRawPropertyResults:()=>B,validateMapClickInputs:()=>F,validateMapClickPipeline:()=>U,validateNumericRange:()=>Z});var r=o(1528),l=o(6250),n=o(2796),a=function(e,t,o,r){return new(o||(o=Promise))((function(l,n){function a(e){try{s(r.next(e))}catch(e){n(e)}}function i(e){try{s(r.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}s((r=r.apply(e,t||[])).next())}))};const i=e=>{if(!e)return"";return((new DOMParser).parseFromString(e,"text/html").body.textContent||"").replace(/[\s\u00A0\u200B]+/g," ").trim()},s={sanitize:i,stripHtml:e=>i(e)},u=e=>s.stripHtml(e),c={debug:(e,t)=>{},warn:(e,t)=>{},error:(e,t,o)=>{console.error(`Property Widget: ${e}`,t,o||{})}},d=(e,t)=>{const o=i(e);return o.length<t?"***":o},p={maskName:e=>{const t=d(e,n.nV);return"***"===t?t:t.split(" ").filter(Boolean).map((e=>`${e.charAt(0)}${"*".repeat(Math.min(n.qC,e.length-1))}`)).join(" ")},maskAddress:e=>{const t=d(e,n.nV);return"***"===t?t:`${t.substring(0,2)}${"*".repeat(Math.min(5,t.length-2))}`}},g=p.maskName,h=p.maskAddress,w=e=>null==e?"":"number"==typeof e?i(String(e)):"string"==typeof e?i(e):"",y={buildKey:(e,t,o)=>{const r=w(e.AGARLISTA);if(r)return`A:${r.toLowerCase()}`;const l=[e.NAMN&&`N:${w(e.NAMN)}`,e.BOSTADR&&`B:${w(e.BOSTADR)}`,e.POSTNR&&`P:${w(e.POSTNR)}`,e.POSTADR&&`C:${w(e.POSTADR)}`,e.ORGNR&&`O:${w(e.ORGNR)}`,e.ANDEL&&`S:${w(e.ANDEL)}`].filter(Boolean);if(l.length>0)return l.join("|").toLowerCase();const n=[t.propertyId&&`PR:${w(t.propertyId)}`,void 0!==t.fnr&&null!==t.fnr&&`FN:${String(t.fnr)}`,void 0!==e.OBJECTID&&null!==e.OBJECTID&&`OB:${String(e.OBJECTID)}`,e.UUID_FASTIGHET&&`UU:${w(e.UUID_FASTIGHET)}`].filter(Boolean);return n.length>0?n.join("|").toLowerCase():`IX:${null!=o?o:0}`},normalizeValue:w},I=(e,t,o)=>{if(!(null==e?void 0:e.TextSymbol)||!t)return null;const r=u(t);return r?new e.TextSymbol({text:r,color:o.textColor,backgroundColor:o.backgroundColor,horizontalAlignment:o.horizontalAlignment,verticalAlignment:o.verticalAlignment,xoffset:o.xoffset,yoffset:o.yoffset,lineWidth:o.lineWidth,lineHeight:o.lineHeight,font:{family:o.fontFamily,size:o.fontSize,weight:o.fontWeight},kerning:o.kerning}):null},m=({modules:e,layer:t,mapPoint:o,tooltipText:r,highlightColor:l,existing:a,style:i=n.Dj})=>{var s,u,c;if(!(null==e?void 0:e.Graphic)||!t)return null!=a?a:null;if(!o)return(null==a?void 0:a.pointGraphic)&&t.remove(a.pointGraphic),(null==a?void 0:a.tooltipGraphic)&&t.remove(a.tooltipGraphic),null;const d={pointGraphic:null!==(s=null==a?void 0:a.pointGraphic)&&void 0!==s?s:null,tooltipGraphic:null!==(u=null==a?void 0:a.tooltipGraphic)&&void 0!==u?u:null,lastTooltipText:null!==(c=null==a?void 0:a.lastTooltipText)&&void 0!==c?c:null};if(d.pointGraphic?d.pointGraphic.geometry=o:(d.pointGraphic=new e.Graphic({geometry:o,symbol:{type:"simple-marker",style:"cross",size:n.Ye,color:l,outline:{color:[l[0],l[1],l[2],1],width:2.5}}}),t.add(d.pointGraphic)),r){if(d.lastTooltipText!==r){const l=I(e,r,i);l?(d.tooltipGraphic?(d.tooltipGraphic.geometry=o,d.tooltipGraphic.symbol=l):(d.tooltipGraphic=new e.Graphic({geometry:o,symbol:l}),t.add(d.tooltipGraphic)),d.lastTooltipText=r):d.tooltipGraphic&&(t.remove(d.tooltipGraphic),d.tooltipGraphic=null,d.lastTooltipText=null)}else d.tooltipGraphic&&(d.tooltipGraphic.geometry=o)}else d.tooltipGraphic&&(t.remove(d.tooltipGraphic),d.tooltipGraphic=null,d.lastTooltipText=null);return d},f=(e,t)=>{const o=(e=>{const t=new Set;return e.map((e=>e.trim())).filter((e=>!(!e||t.has(e)||(t.add(e),0))))})(i(String(e)).split(";"));return t?o.map((e=>(e=>{const t=e.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(!t)return p.maskName(e);const[,o,r]=t;return`${p.maskName(o.trim())} (${r.trim()})`})(e))).filter(Boolean).join("; "):o.join("; ")},b=(e,t,o)=>e.AGARLISTA&&"string"==typeof e.AGARLISTA?f(e.AGARLISTA,t):((e,t,o)=>{const r=i(e.NAMN||"")||o,l=t&&r!==o?p.maskName(r):r,n=i(e.BOSTADR||""),a=t&&n?p.maskAddress(n):n,s=i(e.POSTNR||"").replace(/\s+/g,""),u=i(e.POSTADR||""),c=i(e.ORGNR||"");return`${[l,a,s&&u?`${s} ${u}`:s||u].filter(Boolean).join(", ")}${c?` (${c})`:""}`.trim()||o})(e,t,o),v=(e,t)=>{const o=null==t?void 0:t.trim();return o?`${e} (${o})`:e},S={format:b,mask:{name:g,address:h},buildIdentity:y.buildKey,processBatch:(e,t,o)=>e.map((e=>b(e,t,o)))},D=/^#?([0-9a-fA-F]{6})$/,M=(e,t)=>{const o=n.Tq,r=n.PP,l="string"==typeof e?e.trim():"",a=l?D.exec(l):null,i=a?a[1]:r.replace("#","");return[parseInt(i.substring(0,2),16),parseInt(i.substring(2,4),16),parseInt(i.substring(4,6),16),"number"==typeof t&&Number.isFinite(t)?t<0?0:t>1?1:t:o]},N=(e,t,o)=>{const[r,l,a,i]=e;return"polyline"===o?{style:"solid",color:[r,l,a,i],width:t}:"point"===o?{style:"cross",color:[r,l,a,i],size:n.Ye,outline:{style:"solid",color:[r,l,a,1],width:t}}:{style:"solid",color:[r,l,a,i],outline:{style:"solid",color:[r,l,a,1],width:t}}},A=(e,t)=>`${e}_${t}`,x=e=>{var t;if(!e)return null;const o=null!==(t=e.FNR)&&void 0!==t?t:e.fnr;return"string"==typeof o||"number"==typeof o?o:null},T=e=>null!=e?String(e):"",j=e=>{if(!e||"object"!=typeof e)return!1;const t=e;return"AbortError"===t.name||"string"==typeof t.message&&t.message.toLowerCase().includes("abort")},R={isFiniteNumber:e=>"number"==typeof e&&Number.isFinite(e),clamp:(e,t,o)=>Number.isFinite(e)?e<t?t:e>o?o:e:t,clampWithDefault:(e,t,o,r)=>R.isFiniteNumber(e)?R.clamp(e,t,o):r},L={throwIfAborted:e=>{if(null==e?void 0:e.aborted){const e=new Error("AbortError");throw e.name="AbortError",e}},checkAbortedOrStale:(e,t)=>t()?"stale":e.aborted?"aborted":"active",handleOrThrow:(e,t)=>{if(j(e))throw null==t||t(),e}},k=(e,t)=>{var o;return e?"string"==typeof e?e:"string"==typeof(null===(o=e.details)||void 0===o?void 0:o.message)?e.details.message:"string"==typeof e.message?e.message:t:t},O=(e,t=n.Sh)=>"number"==typeof e&&Number.isFinite(e)?e<.5?.5:e>10?10:e:t,E={isString:e=>"string"==typeof e,isFiniteNumber:e=>"number"==typeof e&&Number.isFinite(e),isNonEmptyString:e=>"string"==typeof e&&e.length>0},C=(e,t="Invalid FNR: must be a safe integer")=>{if("number"==typeof e){if(!Number.isFinite(e)||!Number.isSafeInteger(e)||e<0)throw new Error(t);return`FNR = ${e}`}const o=String(e).replace(/'/g,"''");if(!o.trim())throw new Error("Invalid FNR: cannot be empty or whitespace-only");return`FNR = '${o}'`},z=e=>{const{toRemove:t,removeGraphicsForFnr:o,normalizeFnrKey:r}=e;t.forEach((e=>{o(e,r)}))},H=(e,t)=>{const o=T(e);return t.some((e=>T(e.FNR)===o))},P=(e,t,o)=>!!o&&H(e,t),Q=(e,t,o,r)=>{const l=new Map,n=new Map;t.forEach((e=>{const t=T(e.FNR),o=l.get(t);o?o.push(e):l.set(t,[e]),n.set(e.id,e)}));const a=new Set,i=[],s=new Set;e.forEach((e=>{const t=T(e.FNR);if(o&&!a.has(t)){const e=l.get(t);if(e&&e.length>0)return void a.add(t)}n.has(e.id)||s.has(e.id)||(i.push(e),s.add(e.id))}));const u=a.size>0?t.filter((e=>!a.has(T(e.FNR)))):t.slice();return u.push(...i),u.length>r&&(u.length=r),{toRemove:a,toAdd:i,updatedRows:u}},F=(e,t,o,r)=>t?(null==e?void 0:e.mapPoint)?{valid:!0,data:{mapPoint:e.mapPoint}}:{valid:!1,error:{type:"GEOMETRY_ERROR",message:r("errorNoMapPoint")},failureReason:"no_map_point"}:{valid:!1,error:{type:"VALIDATION_ERROR",message:r("errorLoadingModules")},failureReason:"modules_not_loaded"},G=e=>{const{graphicsToAdd:t,selectedRows:o,view:r,helpers:l,highlightColor:n,outlineWidth:a}=e;if(!r)return!1;const i=new Set(o.map((e=>l.normalizeFnrKey(e.FNR))));return t.forEach((({graphic:e,fnr:t})=>{const o=l.normalizeFnrKey(t);i.has(o)&&l.addGraphicsToMap(e,r,l.extractFnr,l.normalizeFnrKey,n,a)})),!0},U=e=>{const{event:t,modules:o,config:n,dsManager:a,translate:i}=e,s=F(t,o,n,i);if((0,r.k)(s))return s;const u=(0,l.PM)({propertyDsId:n.propertyDataSourceId,ownerDsId:n.ownerDataSourceId,dsManager:a,allowedHosts:n.allowedHosts,translate:i});if((0,r.k)(u))return u;const c=u;return{valid:!0,data:{mapPoint:s.data.mapPoint,manager:c.data.manager}}},W=e=>a(void 0,void 0,void 0,(function*(){const{propertyResults:t,config:o,processingContext:r,services:l}=e;return o.enableBatchOwnerQuery&&void 0!==o.relationshipId&&o.propertyDataSourceId&&void 0!==o.relationshipId?yield l.processBatch({propertyResults:t,config:{propertyDataSourceId:o.propertyDataSourceId,ownerDataSourceId:o.ownerDataSourceId,enablePIIMasking:o.enablePIIMasking,relationshipId:o.relationshipId},context:r}):yield l.processIndividual({propertyResults:t,config:{ownerDataSourceId:o.ownerDataSourceId,enablePIIMasking:o.enablePIIMasking},context:r})})),B=(e,t,o,r,l,n)=>{const a=new Map(e),i=new Map;o.forEach((e=>{var t,o;const r=null===(t=null==e?void 0:e.features)||void 0===t?void 0:t[0],l=null==r?void 0:r.attributes,a=null!==(o=null==l?void 0:l.FNR)&&void 0!==o?o:null==l?void 0:l.fnr;null!=a&&i.set(n(a),e)}));let s=0;const u=new Map;return l.forEach((e=>{u.set(n(e.FNR),e.id)})),t.forEach((e=>{const t=n(e.FNR);let r=i.get(t);if(!r&&o.length>0){const e=o[Math.min(s,o.length-1)];s+=1,r=e}r&&a.set(e.id,r)})),r.forEach((e=>{const t=u.get(e);t&&a.delete(t)})),a},Y=(e,t)=>{if(!e)return[];const o=[];for(const[r,l]of Object.entries(e)){if(r===t||!l)continue;const e=l.state;if(!e)continue;const n=String(e).toUpperCase();"CLOSED"!==n&&"HIDDEN"!==n&&o.push(r)}return o},V=e=>a(void 0,void 0,void 0,(function*(){var t,o,n;const{mapPoint:a,config:i,dsManager:s,signal:u,enablePIIMasking:c,translate:d}=e,p=(0,l.PM)({propertyDsId:i.propertyDataSourceId,ownerDsId:i.ownerDataSourceId,dsManager:s,allowedHosts:i.allowedHosts,translate:d});if((0,r.k)(p))return null;const{manager:g}=p.data,h=yield(0,l.XW)(a,i.propertyDataSourceId,g,{signal:u});if(L.throwIfAborted(u),!h.length||!(null===(o=null===(t=h[0])||void 0===t?void 0:t.features)||void 0===o?void 0:o.length))return null;const w=h[0].features[0],y=x(w.attributes),I=(null===(n=w.attributes)||void 0===n?void 0:n.FASTIGHET)||"";if(!y||!I)return null;const m=yield(0,l.nS)(y,i.ownerDataSourceId,g,{signal:u});L.throwIfAborted(u);let f=d("unknownOwner");if(m.length>0){const e=m[0].attributes;f=b(e,c,d("unknownOwner"))}return{fastighet:I,bostadr:f}})),_=(e,t,o)=>{if(!t)return!1;const r=e.x-t.x,l=e.y-t.y;return Math.sqrt(r*r+l*l)<o},$=(e,t,o,r)=>{if(!e||!e.geometry)return;const l=e.geometry,n=N(t,o,l.type);"polygon"===l.type||"extent"===l.type?e.symbol=new r.SimpleFillSymbol(n):"polyline"===l.type?e.symbol=new r.SimpleLineSymbol(n):"point"!==l.type&&"multipoint"!==l.type||(e.symbol=new r.SimpleMarkerSymbol(n))},Z=e=>{const{value:t,min:o,max:r,errorMessage:l}=e,n="string"==typeof t?parseInt(t,10):t;return isNaN(n)||n<o||n>r?{valid:!1,error:l}:{valid:!0,normalized:n}},q=(e,t,o)=>Number.isFinite(e)?e<t?t:e>o?o:e:t,J={toPercent:e=>{const t=q(e,0,1);return Math.round(100*t)},fromPercent:e=>q(e,0,100)/100,formatPercent:e=>`${q(Math.round(e),0,100)}%`},X={normalize:e=>{const t=q(e,.5,10);return Math.round(2*t)/2},formatDisplay:e=>{const t=q(e,.5,10),o=Math.round(2*t)/2,r=Math.round(o);return Math.abs(o-r)<1e-4?String(r):o.toFixed(1)}},K=e=>u(e||"").trim(),ee=e=>{if(!e||0===e.length)return[];const t=e.map(K).filter((e=>e.length>0));return Array.from(new Set(t))},te={extractId:e=>{var t,o;if(!e)return null;const r=null==e?void 0:e.get;return"function"==typeof r?null!==(t=r.call(e,"dataSourceId"))&&void 0!==t?t:null:null!==(o=null==e?void 0:e.dataSourceId)&&void 0!==o?o:null},findById:(e,t)=>{if(!t||!e)return null;const o=e;if("function"!=typeof o.find)return null;const r=o.find((e=>!!e&&te.extractId(e)===t));return null!=r?r:null}};const oe=new class{constructor(){this.ownersByView=new WeakMap,this.originalStateByView=new WeakMap}acquire(e,t){if(!t)return;const o=t.popupEnabled;if("boolean"!=typeof o)return;let r=this.ownersByView.get(t);r||(r=new Set,this.ownersByView.set(t,r),this.originalStateByView.set(t,o)),r.add(e),t.popupEnabled=!1}release(e,t){if(!t)return;const o=this.ownersByView.get(t);o&&o.delete(e)&&0===o.size&&this.restorePopupState(t)}restorePopupState(e){const t=this.originalStateByView.get(e);void 0!==t&&(e.popupEnabled=t,this.originalStateByView.delete(e),this.ownersByView.delete(e))}}},9244:e=>{"use strict";e.exports=o},9298:e=>{"use strict";e.exports=n},9935:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik03LjUgMEM3LjIyMzg2IDAgNyAwLjIyMzg1OCA3IDAuNVY3SDAuNUMwLjIyMzg1OCA3IDAgNy4yMjM4NiAwIDcuNUMwIDcuNzc2MTQgMC4yMjM4NTggOCAwLjUgOEg3VjE0LjVDNyAxNC43NzYxIDcuMjIzODYgMTUgNy41IDE1QzcuNzc2MTQgMTUgOCAxNC43NzYxIDggMTQuNVY4SDE0LjVDMTQuNzc2MSA4IDE1IDcuNzc2MTQgMTUgNy41QzE1IDcuMjIzODYgMTQuNzc2MSA3IDE0LjUgN0g4VjAuNUM4IDAuMjIzODU4IDcuNzc2MTQgMCA3LjUgMFoiIGZpbGw9ImJsYWNrIi8+DQo8L3N2Zz4NCg=="}},t={};function u(o){var r=t[o];if(void 0!==r)return r.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,u),l.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var o in t)u.o(t,o)&&!u.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{__set_webpack_public_path__:()=>D,default:()=>S});var e=u(9244),t=u(4321),o=u(4337),r=u(9298),l=u(3089);const n={configurationInstructions:"Configure the widget by providing layer URLs and display preferences.",mapWidgetTitle:"Map connection",mapWidgetDescription:"Link the map widget that triggers parcel lookups.",dataSourcesDescription:"Ensure property and owner layers share matching FNR fields.",propertyDataSourceLabel:"Property layer",propertyDataSourceDescription:"Parcel layer containing geometry and FNR values.",ownerDataSourceLabel:"Owner layer",ownerDataSourceDescription:"Owner layer or table with NAMN and BOSTADR details.",displayOptionsTitle:"Display options",panelDisplaySettings:"Display behavior",advancedSettingsTitle:"Advanced settings",panelHighlightSettings:"Highlight styling",highlightColorLabelTooltip:"Set highlight color for parcels.",highlightOpacityLabelTooltip:"Set fill opacity for highlighted parcels.",maxResultsLabel:"Maximum results",maxResultsDescription:"Limit parcel queries to protect performance.",resetMaxResults:"Reset to default",enableToggleRemovalLabel:"Toggle removal",enableToggleRemovalDescription:"Let users click a parcel again to clear it.",enablePIIMaskingLabel:"PII masking",enablePIIMaskingDescription:"Mask names and addresses inside the widget.",highlightOptionsDescription:"Adjust how selected parcels appear on the map.",highlightColorLabel:"Highlight color",highlightOpacityLabel:"Fill opacity",highlightOutlineWidthLabel:"Outline width",highlightOutlineWidthLabelTooltip:"Set the outline width for highlighted parcels.",allowedHostsLabel:"Allowed hosts",allowedHostsDescription:"Whitelist HTTPS hosts that should pass URL checks.",allowedHostsPlaceholder:"lund.se",addAllowedHostLabel:"Add allowed host",allowedHostsListLabel:"Allowed host entries",allowedHostsEmptyHint:"No allowed hosts yet.",removeAllowedHostLabel:"Remove allowed host",enableBatchOwnerQueryLabel:"Batch owner queries",enableBatchOwnerQueryDescription:"Use a relationship to fetch all owners in one request.",relationshipIdLabel:"Relationship ID",relationshipIdDescription:"Relationship ID that links parcels to owner records.",relationshipIdPlaceholder:"e.g., 0, 1, 2",relationshipIdTooltip:"Open /MapServer/[layerId]?f=json to list relationship IDs.",errorInvalidUrl:"Enter a valid ArcGIS REST service URL.",errorInvalidNumber:"Enter a whole number greater than zero.",errorMaxResultsInvalid:"Max results must be between 1 and 1000.",errorRelationshipIdInvalid:"Relationship ID must be between 0 and 99."};var a=u(1888);const i=(t,o={})=>(0,e.css)(Object.assign({display:"flex",flexFlow:`${t} nowrap`},o)),s=()=>(t=>{var o,r;const l=t.sys.spacing,n=t.sys.typography;return{row:(0,e.css)({width:"100%",margin:"16px 0 !important"}),fullWidth:i("column",{inlineSize:"100%",flex:"1 1 auto",minInlineSize:0}),labelWithTooltip:i("row",{alignItems:"center",gap:null==l?void 0:l(1)}),tooltipTrigger:(0,e.css)({margin:"0 !important",padding:"0 !important",opacity:.6,"&:hover":{opacity:1}}),description:(0,e.css)({fontSize:null===(o=null==n?void 0:n.body2)||void 0===o?void 0:o.fontSize,marginBlockStart:null==l?void 0:l(1)}),sliderWrap:i("column",{inlineSize:"100%"}),sliderTrack:i("row",{alignItems:"center",inlineSize:"100%",gap:null==l?void 0:l(2)}),sliderControl:(0,e.css)({flex:"1 1 auto",inlineSize:"100%"}),sliderValue:(0,e.css)({textAlign:"right",fontSize:null===(r=null==n?void 0:n.label2)||void 0===r?void 0:r.fontSize}),allowedHostInputRow:i("row",{inlineSize:"100%",alignItems:"center"}),allowedHostInput:(0,e.css)({flex:"1 1 auto",inlineSize:"100%",minInlineSize:0}),allowedHostList:i("column",{inlineSize:"100%",".input-wrapper":{background:"transparent !important",borderColor:"rgb(106, 106, 106) !important"},"&.disabled .input-wrapper, &.readonly .input-wrapper":{background:"transparent !important",borderColor:"rgb(106, 106, 106) !important",opacity:1,color:"rgb(168, 168, 168)",WebkitTextFillColor:"rgb(168, 168, 168)"}}),addAllowedHostButton:(0,e.css)({border:"none !important"}),allowedHostListRow:i("row",{inlineSize:"100%",alignItems:"center"}),allowedHostListInput:(0,e.css)({flex:"1 1 auto",inlineSize:"100%",minInlineSize:0})}})((0,a.useTheme)());u(2686);var d=u(2796),p=u(8491);const g=(t,o,r,l)=>e.hooks.useEventCallback((e=>{const t=e.target.checked;o(t),r(l,t)})),h=(t,o,r,l,n)=>e.hooks.useEventCallback((e=>{var a,i;const s=Number.parseFloat(null!==(i=null===(a=null==e?void 0:e.target)||void 0===a?void 0:a.value)&&void 0!==i?i:"");if(!Number.isFinite(s))return;const u=n(s);Math.abs(t-u)<1e-4||(o(u),r(l,u))})),w=(t,o,r,l,n)=>e.hooks.useEventCallback((e=>{const{validateNumericRange:a}=u(8491),i=a({value:e,min:o,max:r,errorMessage:l});return n((e=>Object.assign(Object.assign({},e),{[t]:i.valid?void 0:i.error}))),i.valid}));var y=u(9935),I=u.n(y),m=u(1601),f=u.n(m),b=u(7519),v=u.n(b);const S=a=>{const{config:i,id:u,onSettingChange:c,useMapWidgetIds:y}=a,m=e.hooks.useTranslation(t.defaultMessages,n),b=s(),S=(o,r)=>{const l=m(o),n=m(r);return(0,e.jsx)("div",{css:b.labelWithTooltip},(0,e.jsx)("span",null,l),(0,e.jsx)(t.Tooltip,{title:n,placement:"top",showArrow:!0},(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,"aria-label":n,css:b.tooltipTrigger},(0,e.jsx)(t.SVG,{src:v()}))))},D=e=>{if(!e)return null;const t=e.asMutable;return"function"==typeof t?t.call(e,{deep:!0}):e},M=t=>{if(!t||!a.useDataSources)return(0,e.Immutable)([]);const o=a.useDataSources,r="function"==typeof o.filter?o.filter((e=>(null==e?void 0:e.dataSourceId)===t)):[],l="function"==typeof(null==r?void 0:r.asMutable)?r.asMutable({deep:!0}):r;return(0,e.Immutable)(l)},N=(t=>{const o=e.hooks.useLatest(t);return e.hooks.useEventCallback(((e,t=!1)=>{var r;const l=null===(r=o.current)||void 0===r?void 0:r[e];return"boolean"==typeof l?l:t}))})(i),A=((t,o,r)=>e.hooks.useEventCallback(((e,l)=>{r({id:t,config:o.set?o.set(e,l):Object.assign(Object.assign({},o),{[e]:l})})})))(u,i,c),[x,T]=e.React.useState((()=>String(i.maxResults||50))),[j,R]=e.React.useState((()=>N("enableToggleRemoval"))),[L,k]=e.React.useState((()=>N("enablePIIMasking"))),[O,E]=e.React.useState((()=>N("enableBatchOwnerQuery",!1))),[C,z]=e.React.useState((()=>{var e;return String(null!==(e=i.relationshipId)&&void 0!==e?e:0)})),[H,P]=e.React.useState(""),[Q,F]=e.React.useState((()=>(0,p.normalizeHostList)(i.allowedHosts))),[G,U]=e.React.useState(i.highlightColor||d.PP),[W,B]=e.React.useState((()=>{const e="number"==typeof i.highlightOpacity?i.highlightOpacity:d.Tq;return p.opacityHelpers.fromPercent(p.opacityHelpers.toPercent(e))})),[Y,V]=e.React.useState((()=>{const e="number"==typeof i.outlineWidth?i.outlineWidth:d.Sh;return p.outlineWidthHelpers.normalize(e)})),[_,$]=e.React.useState({}),Z=w("maxResults",1,1e3,m("errorMaxResultsInvalid"),$),q=w("relationshipId",0,99,m("errorRelationshipIdInvalid"),$),J=((t,o,r)=>{const l=Number.isFinite(o)&&o>=0?o:0,n=e.React.useRef(null),a=e.React.useRef(!1),i=e.React.useRef(!0),s=e.hooks.useLatest(t),u=e.hooks.useLatest(r),c=e.hooks.useEventCallback((e=>{var t;if(a.current===e)return;a.current=e;const o=null===(t=u.current)||void 0===t?void 0:t.onPendingChange;if("function"==typeof o)try{o(e)}catch(e){}})),d=e.hooks.useEventCallback((()=>{n.current&&(clearTimeout(n.current),n.current=null),a.current&&c(!1)})),p=e.hooks.useEventCallback(((...e)=>{n.current&&clearTimeout(n.current),c(!0),n.current=setTimeout((()=>{if(n.current=null,i.current)try{s.current(...e)}finally{c(!1)}}),l)})),g=e.React.useRef(null),h=e.hooks.useLatest(p),w=e.hooks.useLatest(d);if(!g.current){const e=(...e)=>{h.current(...e)};e.cancel=()=>w.current(),g.current=e}return e.hooks.useEffectOnce((()=>()=>{i.current=!1,w.current()})),g.current})(Z,500),X=e.hooks.useEventCallback((e=>{T(String(e)),J(String(e))})),K=e.hooks.useEventCallback((()=>{J.cancel();if(Z(x)){const e=parseInt(x,10);A("maxResults",e)}})),ee=g(0,R,A,"enableToggleRemoval"),te=g(0,k,A,"enablePIIMasking"),oe=g(0,E,A,"enableBatchOwnerQuery"),re=e.hooks.useEventCallback((e=>{const t=Math.max(0,Math.min(99,Math.round(e)));z(String(t))})),le=e.hooks.useEventCallback((()=>{if(q(C)){const e=parseInt(C,10);A("relationshipId",e)}})),ne=e.hooks.useEventCallback((e=>{P(e.target.value)})),ae=e.hooks.useEventCallback((()=>{const e=(0,p.normalizeHostValue)(H);if(!e)return void P("");if(Q.includes(e))return;const t=[...Q,e];F(t),A("allowedHosts",t),P("")})),ie=e.hooks.useEventCallback((e=>{const t=(0,p.normalizeHostValue)(e),o=Q.filter((e=>e!==t));o.length!==Q.length&&(F(o),A("allowedHosts",o))})),se=e.hooks.useEventCallback((e=>{"Enter"===e.key&&(e.preventDefault(),xe&&ae())})),ue=e.hooks.useEventCallback((e=>{const t=e||d.PP;U(t),A("highlightColor",t)})),ce=h(W,B,A,"highlightOpacity",p.opacityHelpers.fromPercent),de=h(Y,V,A,"outlineWidth",p.outlineWidthHelpers.normalize),pe=e.hooks.useEventCallback((e=>{var t,o,r,l,n;const s=null!==(t=null==e?void 0:e[0])&&void 0!==t?t:null,d=null!==(o=null==s?void 0:s.dataSourceId)&&void 0!==o?o:"",p=null!==(n=null===(l=null===(r=a.useDataSources)||void 0===r?void 0:r.find)||void 0===l?void 0:l.call(r,(e=>(null==e?void 0:e.dataSourceId)===i.ownerDataSourceId)))&&void 0!==n?n:null,g=D(p),h=!!d&&!i.ownerDataSourceId||!!d&&i.ownerDataSourceId&&i.ownerDataSourceId===i.propertyDataSourceId,w=[];s&&w.push(s),g&&g.dataSourceId&&g.dataSourceId!==d&&!h&&w.push(g);const y=h?i.set("propertyDataSourceId",d).set("ownerDataSourceId",d):i.set("propertyDataSourceId",d);c({id:u,useDataSources:w,config:y})})),ge=e.hooks.useEventCallback((e=>{var t,o,r,l,n;const s=null!==(t=null==e?void 0:e[0])&&void 0!==t?t:null,d=null!==(o=null==s?void 0:s.dataSourceId)&&void 0!==o?o:"",p=null!==(n=null===(l=null===(r=a.useDataSources)||void 0===r?void 0:r.find)||void 0===l?void 0:l.call(r,(e=>(null==e?void 0:e.dataSourceId)===i.propertyDataSourceId)))&&void 0!==n?n:null;let g=D(p);!g&&i.propertyDataSourceId&&(g={dataSourceId:i.propertyDataSourceId,mainDataSourceId:i.propertyDataSourceId,rootDataSourceId:i.propertyDataSourceId});const h=[];g&&h.push(g),!s||g&&g.dataSourceId===s.dataSourceId||h.push(s);const w=i.set("ownerDataSourceId",d);c({id:u,useDataSources:h,config:w})})),he=e.hooks.useEventCallback((e=>{c({id:u,useMapWidgetIds:e})}));e.hooks.useUpdateEffect((()=>{T(String(i.maxResults||50))}),[i.maxResults]),e.hooks.useUpdateEffect((()=>{R(N("enableToggleRemoval"))}),[i.enableToggleRemoval]),e.hooks.useUpdateEffect((()=>{k(N("enablePIIMasking"))}),[i.enablePIIMasking]),e.hooks.useUpdateEffect((()=>{E(N("enableBatchOwnerQuery",!1))}),[i.enableBatchOwnerQuery]),e.hooks.useUpdateEffect((()=>{var e;z(String(null!==(e=i.relationshipId)&&void 0!==e?e:0))}),[i.relationshipId]),e.hooks.useUpdateEffect((()=>{const e=(0,p.normalizeHostList)(i.allowedHosts);F(e)}),[i.allowedHosts]),e.hooks.useUpdateEffect((()=>{U(i.highlightColor||d.PP)}),[i.highlightColor]),e.hooks.useUpdateEffect((()=>{const e="number"==typeof i.highlightOpacity?i.highlightOpacity:d.Tq;B(p.opacityHelpers.fromPercent(p.opacityHelpers.toPercent(e)))}),[i.highlightOpacity]),e.hooks.useUpdateEffect((()=>{const e="number"==typeof i.outlineWidth?i.outlineWidth:d.Sh;V(p.outlineWidthHelpers.normalize(e))}),[i.outlineWidth]),e.hooks.useEffectOnce((()=>{}));const we=Array.isArray(y)&&y.length>0,ye=Boolean(i.propertyDataSourceId),Ie=Boolean(i.ownerDataSourceId),me=ye&&Ie,fe=we&&me,be=we&&me,ve=!be;e.hooks.useEffectWithPreviousValues((()=>{ve&&(O&&E(!1),i.enableBatchOwnerQuery&&A("enableBatchOwnerQuery",!1),void 0!==i.relationshipId&&A("relationshipId",void 0),"0"!==C&&z("0"),$((e=>Object.assign(Object.assign({},e),{relationshipId:void 0}))))}),[ve,O,i.enableBatchOwnerQuery,i.relationshipId,C,A]);const Se=p.opacityHelpers.toPercent(W),De=p.opacityHelpers.formatPercent(Se),Me=p.outlineWidthHelpers.normalize(Y),Ne=p.outlineWidthHelpers.formatDisplay(Y),Ae=(0,p.normalizeHostValue)(H),xe=Ae.length>0&&!Q.includes(Ae),Te=M(i.propertyDataSourceId),je=M(i.ownerDataSourceId);return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(r.SettingSection,null,(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row,label:S("mapWidgetTitle","mapWidgetDescription")},(0,e.jsx)(r.MapWidgetSelector,{onSelect:he,useMapWidgetIds:y}))),(0,e.jsx)(r.SettingSection,null,we&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row,label:S("propertyDataSourceLabel","propertyDataSourceDescription")},(0,e.jsx)(l.DataSourceSelector,{types:(0,e.Immutable)([e.DataSourceTypes.FeatureLayer]),useDataSources:Te,mustUseDataSource:!0,onChange:pe,widgetId:u,hideTypeDropdown:!0})),(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row,label:S("ownerDataSourceLabel","ownerDataSourceDescription")},(0,e.jsx)(l.DataSourceSelector,{types:(0,e.Immutable)([e.DataSourceTypes.FeatureLayer]),useDataSources:je,mustUseDataSource:!0,onChange:ge,widgetId:u,hideTypeDropdown:!0})),!me&&(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row},(0,e.jsx)(t.Alert,{css:b.fullWidth,type:"warning",text:m("dataSourcesDescription"),closable:!1})))),fe&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(r.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:m("panelDisplaySettings"),type:"default",level:1,role:"group","aria-label":m("panelDisplaySettings")},(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row,label:S("maxResultsLabel","maxResultsDescription")},(0,e.jsx)(t.NumericInput,{css:b.fullWidth,value:parseInt(x,10),min:1,max:1e3,onChange:X,onBlur:K,"aria-label":m("maxResultsLabel"),"aria-invalid":!!_.maxResults})),_.maxResults&&(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row},(0,e.jsx)(t.Alert,{css:b.fullWidth,type:"error",text:_.maxResults,closable:!1})),(0,e.jsx)(r.SettingRow,{flow:"no-wrap",level:1,css:b.row,label:S("enableToggleRemovalLabel","enableToggleRemovalDescription")},(0,e.jsx)(t.Switch,{checked:j,onChange:ee,"aria-label":m("enableToggleRemovalLabel")})),(0,e.jsx)(r.SettingRow,{flow:"no-wrap",level:1,css:b.row,label:S("enablePIIMaskingLabel","enablePIIMaskingDescription")},(0,e.jsx)(t.Switch,{checked:L,onChange:te,"aria-label":m("enablePIIMaskingLabel")})),(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row,label:S("allowedHostsLabel","allowedHostsDescription")},(0,e.jsx)("div",{css:b.allowedHostInputRow},(0,e.jsx)(t.TextInput,{css:b.allowedHostInput,value:H,onChange:ne,onKeyDown:se,placeholder:m("allowedHostsPlaceholder"),"aria-label":m("allowedHostsLabel"),spellCheck:!1}),(0,e.jsx)(t.Button,{type:"default",icon:!0,onClick:ae,title:m("addAllowedHostLabel"),"aria-label":m("addAllowedHostLabel"),disabled:!xe,css:b.addAllowedHostButton},(0,e.jsx)(t.SVG,{src:I(),size:16})))),(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row},(0,e.jsx)("div",{css:b.allowedHostList},Q.length>0?Q.map((o=>(0,e.jsx)("div",{css:b.allowedHostListRow,key:o},(0,e.jsx)(t.TextInput,{css:b.allowedHostListInput,value:o,readOnly:!0,borderless:!0,disabled:!0,spellCheck:!1,"aria-label":`${m("allowedHostsListLabel")}: ${o}`}),(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,onClick:()=>ie(o),title:m("removeAllowedHostLabel"),"aria-label":m("removeAllowedHostLabel")},(0,e.jsx)(t.SVG,{src:f(),size:16}))))):(0,e.jsx)("div",{css:b.description,role:"status","aria-live":"polite"},m("allowedHostsEmptyHint")))))),(0,e.jsx)(r.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:m("panelHighlightSettings"),type:"default",level:1,role:"group","aria-label":m("panelHighlightSettings")},(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row,label:S("highlightColorLabel","highlightColorLabelTooltip")},(0,e.jsx)(o.ColorPicker,{css:b.fullWidth,color:G,onChange:ue,"aria-label":m("highlightColorLabel")})),(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row,label:S("highlightOpacityLabel","highlightOpacityLabelTooltip")},(0,e.jsx)("div",{css:b.sliderWrap},(0,e.jsx)("div",{css:b.sliderTrack},(0,e.jsx)(t.Slider,{value:Se,min:0,max:100,step:5,tooltip:!0,formatter:p.opacityHelpers.formatPercent,"aria-label":m("highlightOpacityLabel"),onChange:ce,css:b.sliderControl}),(0,e.jsx)("div",{css:b.sliderValue,role:"status","aria-live":"polite"},De)))),(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row,label:S("highlightOutlineWidthLabel","highlightOutlineWidthLabelTooltip")},(0,e.jsx)("div",{css:b.sliderWrap},(0,e.jsx)("div",{css:b.sliderTrack},(0,e.jsx)(t.Slider,{value:Me,min:.5,max:10,step:.5,tooltip:!0,formatter:p.outlineWidthHelpers.formatDisplay,"aria-label":m("highlightOutlineWidthLabel"),onChange:de,css:b.sliderControl}),(0,e.jsx)("div",{css:b.sliderValue,role:"status","aria-live":"polite"},Ne))))))),be&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(r.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:m("advancedSettingsTitle"),type:"default",level:1,role:"group","aria-label":m("advancedSettingsTitle")},(0,e.jsx)(r.SettingRow,{flow:"no-wrap",level:1,css:b.row,label:S("enableBatchOwnerQueryLabel","enableBatchOwnerQueryDescription")},(0,e.jsx)(t.Switch,{checked:O,onChange:oe,"aria-label":m("enableBatchOwnerQueryLabel")})),O&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row,label:S("relationshipIdLabel","relationshipIdDescription")},(0,e.jsx)(t.NumericInput,{css:b.fullWidth,value:parseInt(C,10),min:0,max:99,onChange:re,onBlur:le,"aria-label":m("relationshipIdLabel"),title:m("relationshipIdTooltip"),"aria-invalid":!!_.relationshipId})),_.relationshipId&&(0,e.jsx)(r.SettingRow,{flow:"wrap",level:1,css:b.row},(0,e.jsx)(t.Alert,{css:b.fullWidth,type:"error",text:_.relationshipId,closable:!1})))))))};function D(e){u.p=e}})(),c})())}}}));