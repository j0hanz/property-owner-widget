System.register(["jimu-core","jimu-ui","jimu-ui/basic/color-picker","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-theme","jimu-arcgis"],(function(e,t){var r={},o={},n={},i={},a={},l={},s={};return{setters:[function(e){r.DataSourceTypes=e.DataSourceTypes,r.Immutable=e.Immutable,r.React=e.React,r.css=e.css,r.hooks=e.hooks,r.jsx=e.jsx},function(e){o.Alert=e.Alert,o.Button=e.Button,o.CollapsablePanel=e.CollapsablePanel,o.NumericInput=e.NumericInput,o.SVG=e.SVG,o.Slider=e.Slider,o.Switch=e.Switch,o.TextInput=e.TextInput,o.Tooltip=e.Tooltip,o.defaultMessages=e.defaultMessages},function(e){n.ColorPicker=e.ColorPicker},function(e){i.MapWidgetSelector=e.MapWidgetSelector,i.SettingRow=e.SettingRow,i.SettingSection=e.SettingSection},function(e){a.DataSourceSelector=e.DataSourceSelector},function(e){l.useTheme=e.useTheme},function(e){s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={844:(e,t,r)=>{"use strict";r.d(t,{propertyActions:()=>i});var o,n=r(7390);!function(e){e.SET_ERROR="PROPERTY_WIDGET/SET_ERROR",e.CLEAR_ERROR="PROPERTY_WIDGET/CLEAR_ERROR",e.SET_SELECTED_PROPERTIES="PROPERTY_WIDGET/SET_SELECTED_PROPERTIES",e.CLEAR_ALL="PROPERTY_WIDGET/CLEAR_ALL",e.SET_QUERY_IN_FLIGHT="PROPERTY_WIDGET/SET_QUERY_IN_FLIGHT",e.SET_RAW_RESULTS="PROPERTY_WIDGET/SET_RAW_RESULTS",e.REMOVE_WIDGET_STATE="PROPERTY_WIDGET/REMOVE_WIDGET_STATE"}(o||(o={}));Object.values(o);const i={setError:(e,t)=>({type:o.SET_ERROR,error:e,widgetId:t}),clearError:e=>({type:o.CLEAR_ERROR,widgetId:e}),setSelectedProperties:(e,t)=>({type:o.SET_SELECTED_PROPERTIES,properties:e,widgetId:t}),clearAll:e=>({type:o.CLEAR_ALL,widgetId:e}),setQueryInFlight:(e,t)=>({type:o.SET_QUERY_IN_FLIGHT,inFlight:e,widgetId:t}),setRawResults:(e,t)=>({type:o.SET_RAW_RESULTS,results:e,widgetId:t}),removeWidgetState:e=>({type:o.REMOVE_WIDGET_STATE,widgetId:e})},a=(()=>{if("function"==typeof n)return n;const e=n;return e&&"function"==typeof e.default?e.default:e&&"function"==typeof e.Immutable?e.Immutable:e=>e})();a({byId:{}})},1528:(e,t,r)=>{"use strict";function o(e){return e.valid&&"data"in e}function n(e){return!e.valid}r.d(t,{j:()=>o,k:()=>n})},1601:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik04Ljc0NTQ4IDhMMTQuODQ1NiAxNC4xMDAxQzE1LjA1MTUgMTQuMzA2IDE1LjA1MTUgMTQuNjM5NyAxNC44NDU2IDE0Ljg0NTZDMTQuNjM5NyAxNS4wNTE1IDE0LjMwNiAxNS4wNTE1IDE0LjEwMDEgMTQuODQ1Nkw4IDguNzQ1NDhMMS44OTk4NyAxNC44NDU2QzEuNjk0MDEgMTUuMDUxNSAxLjM2MDI1IDE1LjA1MTUgMS4xNTQzOSAxNC44NDU2QzAuOTQ4NTM2IDE0LjYzOTcgMC45NDg1MzYgMTQuMzA2IDEuMTU0MzkgMTQuMTAwMUw3LjI1NDUyIDhMMS4xNTQzOSAxLjg5OTg3QzAuOTQ4NTM1IDEuNjk0MDEgMC45NDg1MzUgMS4zNjAyNSAxLjE1NDM5IDEuMTU0MzlDMS4zNjAyNSAwLjk0ODUzNiAxLjY5NDAxIDAuOTQ4NTM2IDEuODk5ODcgMS4xNTQzOUw4IDcuMjU0NTJMMTQuMTAwMSAxLjE1NDM5QzE0LjMwNiAwLjk0ODUzNSAxNC42Mzk3IDAuOTQ4NTM1IDE0Ljg0NTYgMS4xNTQzOUMxNS4wNTE1IDEuMzYwMjUgMTUuMDUxNSAxLjY5NDAxIDE0Ljg0NTYgMS44OTk4N0w4Ljc0NTQ4IDhaIiBmaWxsPSJibGFjayIvPg0KPC9zdmc+DQo="},1888:e=>{"use strict";e.exports=l},2686:e=>{"use strict";e.exports=s},2796:(e,t,r)=>{"use strict";r.d(t,{Dj:()=>c,Nb:()=>s,PP:()=>i,Sh:()=>l,Tq:()=>a,Ye:()=>u,nV:()=>o,qC:()=>n});const o=3,n=3,i="#b54900",a=.5,l=1,s=5,u=12,c={textColor:"#000000",backgroundColor:"#ffffffe0",fontFamily:"sans-serif",fontSize:10,fontWeight:"normal",verticalAlignment:"top",horizontalAlignment:"center",yoffset:28,xoffset:0,lineWidth:192,lineHeight:1,kerning:!0}},3089:e=>{"use strict";e.exports=a},4321:e=>{"use strict";e.exports=o},4337:e=>{"use strict";e.exports=n},6250:(e,t,r)=>{"use strict";r.d(t,{PM:()=>h,XW:()=>f,nS:()=>y});var o=r(2686),n=r(1528),i=r(8491),a=(r(2796),function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))});new Map;const l=e=>e?{signal:e}:void 0;let s=null,u=null;const c=new Map;const d=(e,t,r)=>({valid:!1,error:{type:e,message:t},failureReason:r}),p=(e,t,r,o)=>{const n=(0,i.normalizeHostList)(r),a=(e=>{var t,r,o,n,i;if(!e)return null;const a=null===(r=null===(t=e.getLayerDefinition)||void 0===t?void 0:t.call(e))||void 0===r?void 0:r.url;if(a)return a;return(null===(n=null===(o=e.getDataSourceJson)||void 0===o?void 0:o.call(e))||void 0===n?void 0:n.url)||(null==e?void 0:e.url)||(null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.url)||null})(e);return a&&((e,t)=>{try{const o=new URL(e);return!(e=>{const t=e.toLowerCase();return"localhost"===t||"127.0.0.1"===t||"::1"===t||"[::1]"===t||/^10\./.test(t)||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(t)||/^192\.168\./.test(t)})(o.hostname)&&(e=>"https:"===e.protocol&&(""===e.port||"443"===e.port))(o)&&!((r=o.pathname).length>500)&&/\/(MapServer|FeatureServer)\/\d+(\/query)?$/.test(r)&&((e,t)=>!t||0===t.length||t.some((t=>{if(e===t)return!0;const r=`.${t}`;return e.endsWith(r)})))(o.hostname,t)}catch(e){return!1}var r})(a,n)?{valid:!0,data:null}:d("VALIDATION_ERROR",o("errorHostNotAllowed"),`${t}_disallowed_host`)},g=(e,t,r)=>e?(e=>null!==e&&"function"==typeof e.query)(e)?{valid:!0,data:null}:d("VALIDATION_ERROR",r("errorNoDataAvailable"),`${t}_ds_not_queryable`):d("VALIDATION_ERROR",r("errorNoDataAvailable"),`${t}_ds_not_found`),h=e=>{const{propertyDsId:t,ownerDsId:r,dsManager:o,allowedHosts:i,translate:a}=e;if(!t||!r)return d("VALIDATION_ERROR",a("errorNoDataAvailable"),"missing_data_sources");if(!o)return d("QUERY_ERROR",a("errorQueryFailed"),"no_data_source_manager");const l=o.getDataSource(t),s=o.getDataSource(r),u=g(l,"property",a);if((0,n.k)(u))return u;const c=g(s,"owner",a);if((0,n.k)(c))return c;if(!l||!s)return d("VALIDATION_ERROR",a("errorNoDataAvailable"),"missing_data_source_instance");const h=p(l,"property",i,a);if((0,n.k)(h))return h;const f=p(s,"owner",i,a);return(0,n.k)(f)?f:{valid:!0,data:{manager:o}}},f=(e,t,r,n)=>a(void 0,void 0,void 0,(function*(){try{i.abortHelpers.throwIfAborted(null==n?void 0:n.signal);const a=r.getDataSource(t);if(!a)throw new Error("Property data source not found");const d=a.url;if(!d)throw new Error("Data source URL not available");if(!s||!u){const[e,t]=yield(0,o.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer","esri/rest/support/Query"]);s=e,u=t}const p=s,g=u;if(!p||!g)throw new Error("Property query modules failed to load");let h=c.get(d);h||(h=new p({url:d}),c.set(d,h));const f=new g({geometry:e,returnGeometry:!0,outFields:["*"],spatialRelationship:"intersects"}),y=yield h.queryFeatures(f,l(null==n?void 0:n.signal));if(i.abortHelpers.throwIfAborted(null==n?void 0:n.signal),!(null==y?void 0:y.features)||0===y.features.length)return[];const I=y.features.map((e=>({features:[e],propertyId:e.attributes.FNR})));return i.logger.debug("Mapped results",{count:I.length,propertyIds:I.map((e=>e.propertyId))}),I}catch(e){if((0,i.isAbortError)(e))throw e;throw new Error((0,i.parseArcGISError)(e,"Property query failed"))}})),y=(e,t,r,o)=>a(void 0,void 0,void 0,(function*(){var n,a,s,u,c,d;try{i.abortHelpers.throwIfAborted(null==o?void 0:o.signal);const p=r.getDataSource(t);if(!p)throw new Error("Owner data source not found");const g=p.url,h=null===(a=(n=p).getLayerDefinition)||void 0===a?void 0:a.call(n);i.logger.debug("Querying owner layer",{dataSourceId:t,url:g,fnr:e,whereClause:(0,i.buildFnrWhereClause)(e),layerName:(null==h?void 0:h.name)||"unknown",layerFields:(null===(s=null==h?void 0:h.fields)||void 0===s?void 0:s.map((e=>e.name)))||[]});const f=yield p.query({where:(0,i.buildFnrWhereClause)(e),returnGeometry:!1,outFields:["*"]},l(null==o?void 0:o.signal));return i.logger.debug("Owner query result",{fnr:e,recordCount:(null===(u=null==f?void 0:f.records)||void 0===u?void 0:u.length)||0,hasRecords:!!((null==f?void 0:f.records)&&f.records.length>0),firstRecord:null===(d=null===(c=null==f?void 0:f.records)||void 0===c?void 0:c[0])||void 0===d?void 0:d.getData()}),i.abortHelpers.throwIfAborted(null==o?void 0:o.signal),(null==f?void 0:f.records)?(0===f.records.length&&i.logger.warn("Owner query returned empty records array",{fnr:e,dataSourceId:t,url:g,possibleCause:"No owner data for this FNR or querying wrong layer"}),f.records.map((t=>{const r=t.getData(),o={attributes:r};return i.logger.debug("Owner record processed",{fnrLength:String(e).length,hasNameField:"string"==typeof(null==r?void 0:r.NAMN)&&r.NAMN.length>0,hasAddressField:"string"==typeof(null==r?void 0:r.BOSTADR)&&r.BOSTADR.length>0,hasOwnerList:"string"==typeof(null==r?void 0:r.AGARLISTA)}),o}))):(i.logger.warn("Owner query returned no records",{fnr:e,dataSourceId:t,url:g,possibleCause:"FNR not found in owner layer or wrong layer configured"}),[])}catch(e){throw i.abortHelpers.handleOrThrow(e),new Error((0,i.parseArcGISError)(e,"Owner query failed"))}}))},7390:(e,t,r)=>{var o;!function(){"use strict";var n=function e(t){var r,o="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),n={use_static:!1};function i(e){var t=Object.getPrototypeOf(e);return t?Object.create(t):{}}function a(e,t,r){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!1,value:r})}"object"!=typeof(r=t)||Array.isArray(r)||null===r||void 0!==t.use_static&&(n.use_static=Boolean(t.use_static));var l="__immutable_invariants_hold";function s(e){return"object"!=typeof e||(null===e||Boolean(Object.getOwnPropertyDescriptor(e,l)))}function u(e,t){return e===t||e!=e&&t!=t}function c(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof Date)}var d=["setPrototypeOf"],p=(d.concat(["push","pop","sort","splice","shift","unshift","reverse"]),["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]));function g(e){this.name="MyError",this.message=e,this.stack=(new Error).stack}function h(e,t){return a(e,l,!0),e}function f(e,t){var r=e[t];a(e,t,(function(){return Q(r.apply(e,arguments))}))}function y(e,t,r){var o=r&&r.deep;if(e in this&&(o&&this[e]!==t&&c(t)&&c(this[e])&&(t=Q.merge(this[e],t,{deep:!0,mode:"replace"})),u(this[e],t)))return this;var n=D.call(this);return n[e]=Q(t),w(n)}d.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]),g.prototype=new Error,g.prototype.constructor=Error;var I=Q([]);function m(e,t,r){var o=e[0];if(1===e.length)return y.call(this,o,t,r);var n,i=e.slice(1),a=this[o];if("object"==typeof a&&null!==a)n=Q.setIn(a,i,t);else{var l=i[0];n=""!==l&&isFinite(l)?m.call(I,i,t):L.call(O,i,t)}if(o in this&&a===n)return this;var s=D.call(this);return s[o]=n,w(s)}function w(e){for(var t in p){if(p.hasOwnProperty(t))f(e,p[t])}n.use_static||(a(e,"flatMap",b),a(e,"asObject",M),a(e,"asMutable",D),a(e,"set",y),a(e,"setIn",m),a(e,"update",C),a(e,"updateIn",z),a(e,"getIn",H));for(var r=0,o=e.length;r<o;r++)e[r]=Q(e[r]);return h(e)}function v(){return new Date(this.getTime())}function b(e){if(0===arguments.length)return this;var t,r=[],o=this.length;for(t=0;t<o;t++){var n=e(this[t],t,this);Array.isArray(n)?r.push.apply(r,n):r.push(n)}return w(r)}function S(e){if(void 0===e&&0===arguments.length)return this;if("function"!=typeof e){var t=Array.isArray(e)?e.slice():Array.prototype.slice.call(arguments);t.forEach((function(e,t,r){"number"==typeof e&&(r[t]=e.toString())})),e=function(e,r){return-1!==t.indexOf(r)}}var r=i(this);for(var o in this)this.hasOwnProperty(o)&&!1===e(this[o],o)&&(r[o]=this[o]);return G(r)}function D(e){var t,r,o=[];if(e&&e.deep)for(t=0,r=this.length;t<r;t++)o.push(A(this[t]));else for(t=0,r=this.length;t<r;t++)o.push(this[t]);return o}function M(e){"function"!=typeof e&&(e=function(e){return e});var t,r={},o=this.length;for(t=0;t<o;t++){var n=e(this[t],t,this),i=n[0],a=n[1];r[i]=a}return G(r)}function A(e){return!e||"object"!=typeof e||!Object.getOwnPropertyDescriptor(e,l)||e instanceof Date?e:Q.asMutable(e,{deep:!0})}function T(e,t){for(var r in e)Object.getOwnPropertyDescriptor(e,r)&&(t[r]=e[r]);return t}function N(e,t){if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(e));var r,o,n=Array.isArray(e),a=t&&t.deep,l=t&&t.mode||"merge",s=t&&t.merger;function d(e,o,n){var l,d=Q(o[n]),p=s&&s(e[n],d,t),g=e[n];void 0===r&&void 0===p&&e.hasOwnProperty(n)&&u(d,g)||(u(g,l=void 0!==p?p:a&&c(g)&&c(d)?Q.merge(g,d,t):d)&&e.hasOwnProperty(n)||(void 0===r&&(r=T(e,i(e))),r[n]=l))}if(n)for(var p=0,g=e.length;p<g;p++){var h=e[p];for(o in h)h.hasOwnProperty(o)&&d(void 0!==r?r:this,h,o)}else{for(o in e)Object.getOwnPropertyDescriptor(e,o)&&d(this,e,o);"replace"===l&&function(e,t){for(var o in e)t.hasOwnProperty(o)||(void 0===r&&(r=T(e,i(e))),delete r[o])}(this,e)}return void 0===r?this:G(r)}function R(e,t){var r=t&&t.deep;if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(e));return Q.merge(this,e,{deep:r,mode:"replace"})}var E,x,j,O=Q({});function L(e,t,r){if(!Array.isArray(e)||0===e.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var o=e[0];if(1===e.length)return k.call(this,o,t,r);var n,a=e.slice(1),l=this[o];if(n=this.hasOwnProperty(o)&&"object"==typeof l&&null!==l?Q.setIn(l,a,t):L.call(O,a,t),this.hasOwnProperty(o)&&l===n)return this;var s=T(this,i(this));return s[o]=n,G(s)}function k(e,t,r){var o=r&&r.deep;if(this.hasOwnProperty(e)&&(o&&this[e]!==t&&c(t)&&c(this[e])&&(t=Q.merge(this[e],t,{deep:!0,mode:"replace"})),u(this[e],t)))return this;var n=T(this,i(this));return n[e]=Q(t),G(n)}function C(e,t){var r=Array.prototype.slice.call(arguments,2),o=this[e];return Q.set(this,e,t.apply(o,[o].concat(r)))}function P(e,t){for(var r=0,o=t.length;null!=e&&r<o;r++)e=e[t[r]];return r&&r==o?e:void 0}function z(e,t){var r=Array.prototype.slice.call(arguments,2),o=P(this,e);return Q.setIn(this,e,t.apply(o,[o].concat(r)))}function H(e,t){var r=P(this,e);return void 0===r?t:r}function _(e){var t,r=i(this);if(e&&e.deep)for(t in this)this.hasOwnProperty(t)&&(r[t]=A(this[t]));else for(t in this)this.hasOwnProperty(t)&&(r[t]=this[t]);return r}function F(){return{}}function G(e){return n.use_static||(a(e,"merge",N),a(e,"replace",R),a(e,"without",S),a(e,"asMutable",_),a(e,"set",k),a(e,"setIn",L),a(e,"update",C),a(e,"updateIn",z),a(e,"getIn",H)),h(e)}function Q(e,t,r){if(s(e)||function(e){return"object"==typeof e&&null!==e&&(60103===e.$$typeof||e.$$typeof===o)}(e)||function(e){return"undefined"!=typeof File&&e instanceof File}(e)||function(e){return"undefined"!=typeof Blob&&e instanceof Blob}(e)||function(e){return e instanceof Error}(e))return e;if(function(e){return"object"==typeof e&&"function"==typeof e.then}(e))return e.then(Q);if(Array.isArray(e))return w(e.slice());if(e instanceof Date)return i=new Date(e.getTime()),n.use_static||a(i,"asMutable",v),h(i);var i,l=t&&t.prototype,u=(l&&l!==Object.prototype?function(){return Object.create(l)}:F)();for(var c in e)Object.getOwnPropertyDescriptor(e,c)&&(u[c]=Q(e[c],void 0,r));return G(u)}function U(e){return function(){var t=[].slice.call(arguments),r=t.shift();return e.apply(r,t)}}function W(e,t){return function(){var r=[].slice.call(arguments),o=r.shift();return Array.isArray(o)?t.apply(o,r):e.apply(o,r)}}return Q.from=Q,Q.isImmutable=s,Q.ImmutableError=g,Q.merge=U(N),Q.replace=U(R),Q.without=U(S),Q.asMutable=(E=_,x=D,j=v,function(){var e=[].slice.call(arguments),t=e.shift();return Array.isArray(t)?x.apply(t,e):t instanceof Date?j.apply(t,e):E.apply(t,e)}),Q.set=W(k,y),Q.setIn=W(L,m),Q.update=U(C),Q.updateIn=U(z),Q.getIn=U(H),Q.flatMap=U(b),Q.asObject=U(M),n.use_static||(Q.static=e({use_static:!0})),Object.freeze(Q),Q}();void 0===(o=function(){return n}.call(t,r,t,e))||(e.exports=o)}()},7519:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCINCiAgICAgICAgZD0iTTE1IDhDMTUgMTEuODY2IDExLjg2NiAxNSA4IDE1QzQuMTM0MDEgMTUgMSAxMS44NjYgMSA4QzEgNC4xMzQwMSA0LjEzNDAxIDEgOCAxQzExLjg2NiAxIDE1IDQuMTM0MDEgMTUgOFpNMTYgOEMxNiAxMi40MTgzIDEyLjQxODMgMTYgOCAxNkMzLjU4MTcyIDE2IDAgMTIuNDE4MyAwIDhDMCAzLjU4MTcyIDMuNTgxNzIgMCA4IDBDMTIuNDE4MyAwIDE2IDMuNTgxNzIgMTYgOFpNOC4zMjQwNiAxMC4yMjhINy4zNDAwNkM3LjEyNzQ1IDkuMDg5NTIgNy45NjE0MSA4LjA5ODY4IDguNzE1MSA3LjIwMzIxQzkuMjgwMTQgNi41MzE4OCA5LjgwMDA2IDUuOTE0MTUgOS44MDAwNiA1LjMyOEM5LjgwMDA2IDQuNSA5LjIwMDA2IDMuOSA3Ljk3NjA2IDMuOUM3LjE2MDA2IDMuOSA2LjQwNDA2IDQuMjYgNS43MDgwNiA0Ljk5Mkw1LjA2MDA2IDQuMzkyQzUuODUyMDYgMy41NTIgNi43ODgwNiAzIDguMDk2MDYgM0M5Ljc4ODA2IDMgMTAuODY4MSAzLjg2NCAxMC44NjgxIDUuMjQ0QzEwLjg2ODEgNi4xMDgyIDEwLjIxNTcgNi44NzIzMiA5LjU2ODM3IDcuNjMwNTJDOC44NTg0NCA4LjQ2MjA2IDguMTU0NTggOS4yODY0OCA4LjMyNDA2IDEwLjIyOFpNOC42MjQwNiAxMi40QzguNjI0MDYgMTIuODggOC4yNzYwNiAxMy4xOTIgNy44NTYwNiAxMy4xOTJDNy40MjQwNiAxMy4xOTIgNy4wNzYwNiAxMi44OCA3LjA3NjA2IDEyLjRDNy4wNzYwNiAxMS45MiA3LjQyNDA2IDExLjU5NiA3Ljg1NjA2IDExLjU5NkM4LjI3NjA2IDExLjU5NiA4LjYyNDA2IDExLjkyIDguNjI0MDYgMTIuNFoiDQogICAgICAgIGZpbGw9ImJsYWNrIiAvPg0KPC9zdmc+"},8491:(e,t,r)=>{"use strict";r.r(t),r.d(t,{abortHelpers:()=>O,buildFnrWhereClause:()=>P,buildHighlightColor:()=>A,buildHighlightSymbolJSON:()=>T,buildTooltipSymbol:()=>m,calculatePropertyUpdates:()=>F,cleanupRemovedGraphics:()=>z,computeWidgetsToClose:()=>V,createPropertyDispatcher:()=>Y,createRowId:()=>N,dataSourceHelpers:()=>oe,executeHoverQuery:()=>$,extractFnr:()=>R,formatOwnerInfo:()=>b,formatPropertyWithShare:()=>S,getValidatedOutlineWidth:()=>k,isAbortError:()=>x,isDuplicateProperty:()=>H,isValidationFailure:()=>o.k,isValidationSuccess:()=>o.j,logger:()=>d,maskAddress:()=>f,maskName:()=>h,normalizeFnrKey:()=>E,normalizeHostList:()=>re,normalizeHostValue:()=>te,numberHelpers:()=>j,opacityHelpers:()=>K,outlineWidthHelpers:()=>ee,ownerIdentity:()=>I,ownerPrivacy:()=>g,ownerProcessing:()=>D,parseArcGISError:()=>L,popupSuppressionManager:()=>ne,processPropertyQueryResults:()=>W,shouldSkipHoverQuery:()=>Z,shouldToggleRemove:()=>_,stripHtml:()=>c,syncCursorGraphics:()=>w,syncGraphicsWithState:()=>Q,textSanitizer:()=>u,typeGuards:()=>C,updateGraphicSymbol:()=>q,updateRawPropertyResults:()=>B,validateMapClickInputs:()=>G,validateMapClickPipeline:()=>U,validateNumericRange:()=>J});var o=r(1528),n=r(6250),i=r(2796),a=r(844),l=function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))};const s=e=>{if(!e)return"";return((new DOMParser).parseFromString(e,"text/html").body.textContent||"").replace(/[\s\u00A0\u200B]+/g," ").trim()},u={sanitize:s,stripHtml:e=>s(e)},c=e=>u.stripHtml(e),d={debug:(e,t)=>{},warn:(e,t)=>{},error:(e,t,r)=>{console.error(`Property Widget: ${e}`,t,r||{})}},p=(e,t)=>{const r=s(e);return r.length<t?"***":r},g={maskName:e=>{const t=p(e,i.nV);return"***"===t?t:t.split(" ").filter(Boolean).map((e=>`${e.charAt(0)}${"*".repeat(Math.min(i.qC,e.length-1))}`)).join(" ")},maskAddress:e=>{const t=p(e,i.nV);return"***"===t?t:`${t.substring(0,2)}${"*".repeat(Math.min(5,t.length-2))}`}},h=g.maskName,f=g.maskAddress,y=e=>null==e?"":"number"==typeof e?s(String(e)):"string"==typeof e?s(e):"",I={buildKey:(e,t,r)=>{const o=y(e.AGARLISTA);if(o)return`A:${o.toLowerCase()}`;const n=[e.NAMN&&`N:${y(e.NAMN)}`,e.BOSTADR&&`B:${y(e.BOSTADR)}`,e.POSTNR&&`P:${y(e.POSTNR)}`,e.POSTADR&&`C:${y(e.POSTADR)}`,e.ORGNR&&`O:${y(e.ORGNR)}`,e.ANDEL&&`S:${y(e.ANDEL)}`].filter(Boolean);if(n.length>0)return n.join("|").toLowerCase();const i=[t.propertyId&&`PR:${y(t.propertyId)}`,void 0!==t.fnr&&null!==t.fnr&&`FN:${String(t.fnr)}`,void 0!==e.OBJECTID&&null!==e.OBJECTID&&`OB:${String(e.OBJECTID)}`,e.UUID_FASTIGHET&&`UU:${y(e.UUID_FASTIGHET)}`].filter(Boolean);return i.length>0?i.join("|").toLowerCase():`IX:${null!=r?r:0}`},normalizeValue:y},m=(e,t,r)=>{if(!(null==e?void 0:e.TextSymbol)||!t)return null;const o=c(t);return o?new e.TextSymbol({text:o,color:r.textColor,backgroundColor:r.backgroundColor,horizontalAlignment:r.horizontalAlignment,verticalAlignment:r.verticalAlignment,xoffset:r.xoffset,yoffset:r.yoffset,lineWidth:r.lineWidth,lineHeight:r.lineHeight,font:{family:r.fontFamily,size:r.fontSize,weight:r.fontWeight},kerning:r.kerning}):null},w=({modules:e,layer:t,mapPoint:r,tooltipText:o,highlightColor:n,existing:a,style:l=i.Dj})=>{var s,u,c;if(!(null==e?void 0:e.Graphic)||!t)return null!=a?a:null;if(!r)return(null==a?void 0:a.pointGraphic)&&t.remove(a.pointGraphic),(null==a?void 0:a.tooltipGraphic)&&t.remove(a.tooltipGraphic),null;const d={pointGraphic:null!==(s=null==a?void 0:a.pointGraphic)&&void 0!==s?s:null,tooltipGraphic:null!==(u=null==a?void 0:a.tooltipGraphic)&&void 0!==u?u:null,lastTooltipText:null!==(c=null==a?void 0:a.lastTooltipText)&&void 0!==c?c:null};if(d.pointGraphic?d.pointGraphic.geometry=r:(d.pointGraphic=new e.Graphic({geometry:r,symbol:{type:"simple-marker",style:"cross",size:i.Ye,color:n,outline:{color:[n[0],n[1],n[2],1],width:2.5}}}),t.add(d.pointGraphic)),o){if(d.lastTooltipText!==o){const n=m(e,o,l);n?(d.tooltipGraphic?(d.tooltipGraphic.geometry=r,d.tooltipGraphic.symbol=n):(d.tooltipGraphic=new e.Graphic({geometry:r,symbol:n}),t.add(d.tooltipGraphic)),d.lastTooltipText=o):d.tooltipGraphic&&(t.remove(d.tooltipGraphic),d.tooltipGraphic=null,d.lastTooltipText=null)}else d.tooltipGraphic&&(d.tooltipGraphic.geometry=r)}else d.tooltipGraphic&&(t.remove(d.tooltipGraphic),d.tooltipGraphic=null,d.lastTooltipText=null);return d},v=(e,t)=>{const r=(e=>{const t=new Set;return e.map((e=>e.trim())).filter((e=>!(!e||t.has(e)||(t.add(e),0))))})(s(String(e)).split(";"));return t?r.map((e=>(e=>{const t=e.match(/^(.+?)\s*\(([^)]+)\)\s*$/);if(!t)return g.maskName(e);const[,r,o]=t;return`${g.maskName(r.trim())} (${o.trim()})`})(e))).filter(Boolean).join("; "):r.join("; ")},b=(e,t,r)=>e.AGARLISTA&&"string"==typeof e.AGARLISTA?v(e.AGARLISTA,t):((e,t,r)=>{const o=s(e.NAMN||"")||r,n=t&&o!==r?g.maskName(o):o,i=s(e.BOSTADR||""),a=t&&i?g.maskAddress(i):i,l=s(e.POSTNR||"").replace(/\s+/g,""),u=s(e.POSTADR||""),c=s(e.ORGNR||"");return`${[n,a,l&&u?`${l} ${u}`:l||u].filter(Boolean).join(", ")}${c?` (${c})`:""}`.trim()||r})(e,t,r),S=(e,t)=>{const r=null==t?void 0:t.trim();return r?`${e} (${r})`:e},D={format:b,mask:{name:h,address:f},buildIdentity:I.buildKey,processBatch:(e,t,r)=>e.map((e=>b(e,t,r)))},M=/^#?([0-9a-fA-F]{6})$/,A=(e,t)=>{const r=i.Tq,o=i.PP,n="string"==typeof e?e.trim():"",a=n?M.exec(n):null,l=a?a[1]:o.replace("#","");return[parseInt(l.substring(0,2),16),parseInt(l.substring(2,4),16),parseInt(l.substring(4,6),16),"number"==typeof t&&Number.isFinite(t)?t<0?0:t>1?1:t:r]},T=(e,t,r)=>{const[o,n,a,l]=e;return"polyline"===r?{style:"solid",color:[o,n,a,l],width:t}:"point"===r?{style:"cross",color:[o,n,a,l],size:i.Ye,outline:{style:"solid",color:[o,n,a,1],width:t}}:{style:"solid",color:[o,n,a,l],outline:{style:"solid",color:[o,n,a,1],width:t}}},N=(e,t)=>`${e}_${t}`,R=e=>{var t;if(!e)return null;const r=null!==(t=e.FNR)&&void 0!==t?t:e.fnr;return"string"==typeof r||"number"==typeof r?r:null},E=e=>null!=e?String(e):"",x=e=>{if(!e||"object"!=typeof e)return!1;const t=e;return"AbortError"===t.name||"string"==typeof t.message&&t.message.toLowerCase().includes("abort")},j={isFiniteNumber:e=>"number"==typeof e&&Number.isFinite(e),clamp:(e,t,r)=>Number.isFinite(e)?e<t?t:e>r?r:e:t,clampWithDefault:(e,t,r,o)=>j.isFiniteNumber(e)?j.clamp(e,t,r):o},O={throwIfAborted:e=>{if(null==e?void 0:e.aborted){const e=new Error("AbortError");throw e.name="AbortError",e}},checkAbortedOrStale:(e,t)=>t()?"stale":e.aborted?"aborted":"active",handleOrThrow:(e,t)=>{if(x(e))throw null==t||t(),e}},L=(e,t)=>{var r;return e?"string"==typeof e?e:"string"==typeof(null===(r=e.details)||void 0===r?void 0:r.message)?e.details.message:"string"==typeof e.message?e.message:t:t},k=(e,t=i.Sh)=>"number"==typeof e&&Number.isFinite(e)?e<.5?.5:e>10?10:e:t,C={isString:e=>"string"==typeof e,isFiniteNumber:e=>"number"==typeof e&&Number.isFinite(e),isNonEmptyString:e=>"string"==typeof e&&e.length>0},P=(e,t="Invalid FNR: must be a safe integer")=>{if("number"==typeof e){if(!Number.isFinite(e)||!Number.isSafeInteger(e)||e<0)throw new Error(t);return`FNR = ${e}`}const r=String(e).replace(/'/g,"''");if(!r.trim())throw new Error("Invalid FNR: cannot be empty or whitespace-only");return`FNR = '${r}'`},z=e=>{const{toRemove:t,removeGraphicsForFnr:r,normalizeFnrKey:o}=e;t.forEach((e=>{r(e,o)}))},H=(e,t)=>{const r=E(e);return t.some((e=>E(e.FNR)===r))},_=(e,t,r)=>!!r&&H(e,t),F=(e,t,r,o)=>{const n=new Map,i=new Map;t.forEach((e=>{const t=E(e.FNR),r=n.get(t);r?r.push(e):n.set(t,[e]),i.set(e.id,e)}));const a=new Set,l=[],s=new Set;e.forEach((e=>{const t=E(e.FNR);if(r&&!a.has(t)){const e=n.get(t);if(e&&e.length>0)return void a.add(t)}i.has(e.id)||s.has(e.id)||(l.push(e),s.add(e.id))}));const u=a.size>0?t.filter((e=>!a.has(E(e.FNR)))):t.slice();return u.push(...l),u.length>o&&(u.length=o),{toRemove:a,toAdd:l,updatedRows:u}},G=(e,t,r,o)=>t?(null==e?void 0:e.mapPoint)?{valid:!0,data:{mapPoint:e.mapPoint}}:{valid:!1,error:{type:"GEOMETRY_ERROR",message:o("errorNoMapPoint")},failureReason:"no_map_point"}:{valid:!1,error:{type:"VALIDATION_ERROR",message:o("errorLoadingModules")},failureReason:"modules_not_loaded"},Q=e=>{const{graphicsToAdd:t,selectedRows:r,view:o,helpers:n,highlightColor:i,outlineWidth:a}=e;if(!o)return!1;const l=new Set(r.map((e=>n.normalizeFnrKey(e.FNR))));return t.forEach((({graphic:e,fnr:t})=>{const r=n.normalizeFnrKey(t);l.has(r)&&n.addGraphicsToMap(e,o,n.extractFnr,n.normalizeFnrKey,i,a)})),!0},U=e=>{const{event:t,modules:r,config:i,dsManager:a,translate:l}=e,s=G(t,r,i,l);if((0,o.k)(s))return s;const u=(0,n.PM)({propertyDsId:i.propertyDataSourceId,ownerDsId:i.ownerDataSourceId,dsManager:a,allowedHosts:i.allowedHosts,translate:l});if((0,o.k)(u))return u;const c=u;return{valid:!0,data:{mapPoint:s.data.mapPoint,manager:c.data.manager}}},W=e=>l(void 0,void 0,void 0,(function*(){const{propertyResults:t,config:r,processingContext:o,services:n}=e;return r.enableBatchOwnerQuery&&void 0!==r.relationshipId&&r.propertyDataSourceId&&void 0!==r.relationshipId?yield n.processBatch({propertyResults:t,config:{propertyDataSourceId:r.propertyDataSourceId,ownerDataSourceId:r.ownerDataSourceId,enablePIIMasking:r.enablePIIMasking,relationshipId:r.relationshipId},context:o}):yield n.processIndividual({propertyResults:t,config:{ownerDataSourceId:r.ownerDataSourceId,enablePIIMasking:r.enablePIIMasking},context:o})})),B=(e,t,r,o,n,i)=>{const a=new Map(e),l=new Map;r.forEach((e=>{var t,r;const o=null===(t=null==e?void 0:e.features)||void 0===t?void 0:t[0],n=null==o?void 0:o.attributes,a=null!==(r=null==n?void 0:n.FNR)&&void 0!==r?r:null==n?void 0:n.fnr;null!=a&&l.set(i(a),e)}));let s=0;const u=new Map;return n.forEach((e=>{u.set(i(e.FNR),e.id)})),t.forEach((e=>{const t=i(e.FNR);let o=l.get(t);if(!o&&r.length>0){const e=r[Math.min(s,r.length-1)];s+=1,o=e}o&&a.set(e.id,o)})),o.forEach((e=>{const t=u.get(e);t&&a.delete(t)})),a},Y=(e,t)=>{const r=r=>{t&&"function"==typeof e&&e(r)};return{setError:e=>{r(a.propertyActions.setError(e,t))},clearError:()=>{r(a.propertyActions.clearError(t))},setSelectedProperties:e=>{r(a.propertyActions.setSelectedProperties(Array.from(e),t))},clearAll:()=>{r(a.propertyActions.clearAll(t))},setQueryInFlight:e=>{r(a.propertyActions.setQueryInFlight(e,t))},setRawResults:e=>{r(a.propertyActions.setRawResults((e=>e?(Map,new Map(e)):null)(e),t))},removeWidgetState:()=>{r(a.propertyActions.removeWidgetState(t))}}},V=(e,t,r)=>{if(!e)return[];const o=[],n=(e,t)=>{var r;return e?"function"==typeof(null==e?void 0:e.get)?e.get(t):null!==(r=null==e?void 0:e[t])&&void 0!==r?r:null:null},i=(e,t)=>{if(!e)return"";if("function"==typeof e.get){const r=e.get(t);return"string"==typeof r?r:""}const r=null==e?void 0:e[t];return"string"==typeof r?r:""},a=e=>{const t=n(r,e);if(!t)return!1;const o=n(t,"manifest");return[i(t,"name"),i(t,"label"),i(t,"manifestLabel"),i(t,"uri"),i(t,"widgetName"),i(o,"name"),i(o,"label"),i(o,"uri")].some((e=>{if(!e)return!1;const t=e.toLowerCase();return t.includes("property")||t.includes("fastighet")}))};for(const[r,n]of Object.entries(e)){if(r===t||!n)continue;const e=n.state;if(!e)continue;const i=String(e).toUpperCase();"CLOSED"!==i&&"HIDDEN"!==i&&(n.isClassLoaded&&a(r)&&o.push(r))}return o},$=e=>l(void 0,void 0,void 0,(function*(){var t,r,i;const{mapPoint:a,config:l,dsManager:s,signal:u,enablePIIMasking:c,translate:d}=e,p=(0,n.PM)({propertyDsId:l.propertyDataSourceId,ownerDsId:l.ownerDataSourceId,dsManager:s,allowedHosts:l.allowedHosts,translate:d});if((0,o.k)(p))return null;const{manager:g}=p.data,h=yield(0,n.XW)(a,l.propertyDataSourceId,g,{signal:u});if(O.throwIfAborted(u),!h.length||!(null===(r=null===(t=h[0])||void 0===t?void 0:t.features)||void 0===r?void 0:r.length))return null;const f=h[0].features[0],y=R(f.attributes),I=(null===(i=f.attributes)||void 0===i?void 0:i.FASTIGHET)||"";if(!y||!I)return null;const m=yield(0,n.nS)(y,l.ownerDataSourceId,g,{signal:u});O.throwIfAborted(u);let w=d("unknownOwner");if(m.length>0){const e=m[0].attributes;w=b(e,c,d("unknownOwner"))}return{fastighet:I,bostadr:w}})),Z=(e,t,r)=>{if(!t)return!1;const o=e.x-t.x,n=e.y-t.y;return Math.sqrt(o*o+n*n)<r},q=(e,t,r,o)=>{if(!e||!e.geometry)return;const n=e.geometry,i=T(t,r,n.type);"polygon"===n.type||"extent"===n.type?e.symbol=new o.SimpleFillSymbol(i):"polyline"===n.type?e.symbol=new o.SimpleLineSymbol(i):"point"!==n.type&&"multipoint"!==n.type||(e.symbol=new o.SimpleMarkerSymbol(i))},J=e=>{const{value:t,min:r,max:o,errorMessage:n}=e,i="string"==typeof t?parseInt(t,10):t;return isNaN(i)||i<r||i>o?{valid:!1,error:n}:{valid:!0,normalized:i}},X=(e,t,r)=>Number.isFinite(e)?e<t?t:e>r?r:e:t,K={toPercent:e=>{const t=X(e,0,1);return Math.round(100*t)},fromPercent:e=>X(e,0,100)/100,formatPercent:e=>`${X(Math.round(e),0,100)}%`},ee={normalize:e=>{const t=X(e,.5,10);return Math.round(2*t)/2},formatDisplay:e=>{const t=X(e,.5,10),r=Math.round(2*t)/2,o=Math.round(r);return Math.abs(r-o)<1e-4?String(o):r.toFixed(1)}},te=e=>c(e||"").trim(),re=e=>{if(!e||0===e.length)return[];const t=e.map(te).filter((e=>e.length>0));return Array.from(new Set(t))},oe={extractId:e=>{var t,r;if(!e)return null;const o=null==e?void 0:e.get;return"function"==typeof o?null!==(t=o.call(e,"dataSourceId"))&&void 0!==t?t:null:null!==(r=null==e?void 0:e.dataSourceId)&&void 0!==r?r:null},findById:(e,t)=>{if(!t||!e)return null;const r=e;if("function"!=typeof r.find)return null;const o=r.find((e=>!!e&&oe.extractId(e)===t));return null!=o?o:null}};const ne=new class{constructor(){this.ownersByView=new WeakMap,this.originalStateByView=new WeakMap}acquire(e,t){if(!t)return;const r=t.popupEnabled;if("boolean"!=typeof r)return;let o=this.ownersByView.get(t);o||(o=new Set,this.ownersByView.set(t,o),this.originalStateByView.set(t,r)),o.add(e),t.popupEnabled=!1}release(e,t){if(!t)return;const r=this.ownersByView.get(t);r&&r.delete(e)&&0===r.size&&this.restorePopupState(t)}restorePopupState(e){const t=this.originalStateByView.get(e);void 0!==t&&(e.popupEnabled=t,this.originalStateByView.delete(e),this.ownersByView.delete(e))}}},9244:e=>{"use strict";e.exports=r},9298:e=>{"use strict";e.exports=i},9935:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik03LjUgMEM3LjIyMzg2IDAgNyAwLjIyMzg1OCA3IDAuNVY3SDAuNUMwLjIyMzg1OCA3IDAgNy4yMjM4NiAwIDcuNUMwIDcuNzc2MTQgMC4yMjM4NTggOCAwLjUgOEg3VjE0LjVDNyAxNC43NzYxIDcuMjIzODYgMTUgNy41IDE1QzcuNzc2MTQgMTUgOCAxNC43NzYxIDggMTQuNVY4SDE0LjVDMTQuNzc2MSA4IDE1IDcuNzc2MTQgMTUgNy41QzE1IDcuMjIzODYgMTQuNzc2MSA3IDE0LjUgN0g4VjAuNUM4IDAuMjIzODU4IDcuNzc2MTQgMCA3LjUgMFoiIGZpbGw9ImJsYWNrIi8+DQo8L3N2Zz4NCg=="}},t={};function u(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,u),n.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var c={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(c),u.d(c,{__set_webpack_public_path__:()=>D,default:()=>S});var e=u(9244),t=u(4321),r=u(4337),o=u(9298),n=u(3089);const i={configurationInstructions:"Configure the widget by providing layer URLs and display preferences.",mapWidgetTitle:"Map connection",mapWidgetDescription:"Link the map widget that triggers parcel lookups.",dataSourcesDescription:"Ensure property and owner layers share matching FNR fields.",propertyDataSourceLabel:"Property layer",propertyDataSourceDescription:"Parcel layer containing geometry and FNR values.",ownerDataSourceLabel:"Owner layer",ownerDataSourceDescription:"Owner layer or table with NAMN and BOSTADR details.",displayOptionsTitle:"Display options",panelDisplaySettings:"Display behavior",advancedSettingsTitle:"Advanced settings",panelHighlightSettings:"Highlight styling",highlightColorLabelTooltip:"Set highlight color for parcels.",highlightOpacityLabelTooltip:"Set fill opacity for highlighted parcels.",maxResultsLabel:"Maximum results",maxResultsDescription:"Limit parcel queries to protect performance.",resetMaxResults:"Reset to default",enableToggleRemovalLabel:"Toggle removal",enableToggleRemovalDescription:"Let users click a parcel again to clear it.",enablePIIMaskingLabel:"PII masking",enablePIIMaskingDescription:"Mask names and addresses inside the widget.",highlightOptionsDescription:"Adjust how selected parcels appear on the map.",highlightColorLabel:"Highlight color",highlightOpacityLabel:"Fill opacity",highlightOutlineWidthLabel:"Outline width",highlightOutlineWidthLabelTooltip:"Set the outline width for highlighted parcels.",allowedHostsLabel:"Allowed hosts",allowedHostsDescription:"Whitelist HTTPS hosts that should pass URL checks.",allowedHostsPlaceholder:"lund.se",addAllowedHostLabel:"Add allowed host",allowedHostsListLabel:"Allowed host entries",allowedHostsEmptyHint:"No allowed hosts yet.",removeAllowedHostLabel:"Remove allowed host",enableBatchOwnerQueryLabel:"Batch owner queries",enableBatchOwnerQueryDescription:"Use a relationship to fetch all owners in one request.",relationshipIdLabel:"Relationship ID",relationshipIdDescription:"Relationship ID that links parcels to owner records.",relationshipIdPlaceholder:"e.g., 0, 1, 2",relationshipIdTooltip:"Open /MapServer/[layerId]?f=json to list relationship IDs.",errorInvalidUrl:"Enter a valid ArcGIS REST service URL.",errorInvalidNumber:"Enter a whole number greater than zero.",errorMaxResultsInvalid:"Max results must be between 1 and 1000.",errorRelationshipIdInvalid:"Relationship ID must be between 0 and 99."};var a=u(1888);const l=(t,r={})=>(0,e.css)(Object.assign({display:"flex",flexFlow:`${t} nowrap`},r)),s=()=>(t=>{var r,o;const n=t.sys.spacing,i=t.sys.typography;return{row:(0,e.css)({width:"100%",margin:"16px 0 !important"}),fullWidth:l("column",{inlineSize:"100%",flex:"1 1 auto",minInlineSize:0}),labelWithTooltip:l("row",{alignItems:"center",gap:null==n?void 0:n(1)}),tooltipTrigger:(0,e.css)({margin:"0 !important",padding:"0 !important",opacity:.6,"&:hover":{opacity:1}}),description:(0,e.css)({fontSize:null===(r=null==i?void 0:i.body2)||void 0===r?void 0:r.fontSize,marginBlockStart:null==n?void 0:n(1)}),sliderWrap:l("column",{inlineSize:"100%"}),sliderTrack:l("row",{alignItems:"center",inlineSize:"100%",gap:null==n?void 0:n(2)}),sliderControl:(0,e.css)({flex:"1 1 auto",inlineSize:"100%"}),sliderValue:(0,e.css)({textAlign:"right",fontSize:null===(o=null==i?void 0:i.label2)||void 0===o?void 0:o.fontSize}),allowedHostInputRow:l("row",{inlineSize:"100%",alignItems:"center"}),allowedHostInput:(0,e.css)({flex:"1 1 auto",inlineSize:"100%",minInlineSize:0}),allowedHostList:l("column",{inlineSize:"100%",".input-wrapper":{background:"transparent !important",borderColor:"rgb(106, 106, 106) !important"},"&.disabled .input-wrapper, &.readonly .input-wrapper":{background:"transparent !important",borderColor:"rgb(106, 106, 106) !important",opacity:1,color:"rgb(168, 168, 168)",WebkitTextFillColor:"rgb(168, 168, 168)"}}),addAllowedHostButton:(0,e.css)({border:"none !important"}),allowedHostListRow:l("row",{inlineSize:"100%",alignItems:"center"}),allowedHostListInput:(0,e.css)({flex:"1 1 auto",inlineSize:"100%",minInlineSize:0})}})((0,a.useTheme)());u(2686);var d=u(2796),p=u(8491);const g=(t,r,o,n)=>e.hooks.useEventCallback((e=>{const t=e.target.checked;r(t),o(n,t)})),h=(t,r,o,n,i)=>e.hooks.useEventCallback((e=>{var a,l;const s=Number.parseFloat(null!==(l=null===(a=null==e?void 0:e.target)||void 0===a?void 0:a.value)&&void 0!==l?l:"");if(!Number.isFinite(s))return;const u=i(s);Math.abs(t-u)<1e-4||(r(u),o(n,u))})),f=(t,r,o,n,i)=>e.hooks.useEventCallback((e=>{const{validateNumericRange:a}=u(8491),l=a({value:e,min:r,max:o,errorMessage:n});return i((e=>Object.assign(Object.assign({},e),{[t]:l.valid?void 0:l.error}))),l.valid}));var y=u(9935),I=u.n(y),m=u(1601),w=u.n(m),v=u(7519),b=u.n(v);const S=a=>{const{config:l,id:u,onSettingChange:c,useMapWidgetIds:y}=a,m=e.hooks.useTranslation(t.defaultMessages,i),v=s(),S=(r,o)=>{const n=m(r),i=m(o);return(0,e.jsx)("div",{css:v.labelWithTooltip},(0,e.jsx)("span",null,n),(0,e.jsx)(t.Tooltip,{title:i,placement:"top",showArrow:!0},(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,"aria-label":i,css:v.tooltipTrigger},(0,e.jsx)(t.SVG,{src:b()}))))},D=e=>{if(!e)return null;const t=e.asMutable;return"function"==typeof t?t.call(e,{deep:!0}):e},M=t=>{if(!t||!a.useDataSources)return(0,e.Immutable)([]);const r=a.useDataSources,o="function"==typeof r.filter?r.filter((e=>(null==e?void 0:e.dataSourceId)===t)):[],n="function"==typeof(null==o?void 0:o.asMutable)?o.asMutable({deep:!0}):o;return(0,e.Immutable)(n)},A=(t=>{const r=e.hooks.useLatest(t);return e.hooks.useEventCallback(((e,t=!1)=>{var o;const n=null===(o=r.current)||void 0===o?void 0:o[e];return"boolean"==typeof n?n:t}))})(l),T=((t,r,o)=>e.hooks.useEventCallback(((e,n)=>{o({id:t,config:r.set?r.set(e,n):Object.assign(Object.assign({},r),{[e]:n})})})))(u,l,c),[N,R]=e.React.useState((()=>String(l.maxResults||50))),[E,x]=e.React.useState((()=>A("enableToggleRemoval"))),[j,O]=e.React.useState((()=>A("enablePIIMasking"))),[L,k]=e.React.useState((()=>A("enableBatchOwnerQuery",!1))),[C,P]=e.React.useState((()=>{var e;return String(null!==(e=l.relationshipId)&&void 0!==e?e:0)})),[z,H]=e.React.useState(""),[_,F]=e.React.useState((()=>(0,p.normalizeHostList)(l.allowedHosts))),[G,Q]=e.React.useState(l.highlightColor||d.PP),[U,W]=e.React.useState((()=>{const e="number"==typeof l.highlightOpacity?l.highlightOpacity:d.Tq;return p.opacityHelpers.fromPercent(p.opacityHelpers.toPercent(e))})),[B,Y]=e.React.useState((()=>{const e="number"==typeof l.outlineWidth?l.outlineWidth:d.Sh;return p.outlineWidthHelpers.normalize(e)})),[V,$]=e.React.useState({}),Z=f("maxResults",1,1e3,m("errorMaxResultsInvalid"),$),q=f("relationshipId",0,99,m("errorRelationshipIdInvalid"),$),J=((t,r,o)=>{const n=Number.isFinite(r)&&r>=0?r:0,i=e.React.useRef(null),a=e.React.useRef(!1),l=e.React.useRef(!0),s=e.hooks.useLatest(t),u=e.hooks.useLatest(o),c=e.hooks.useEventCallback((e=>{var t;if(a.current===e)return;a.current=e;const r=null===(t=u.current)||void 0===t?void 0:t.onPendingChange;if("function"==typeof r)try{r(e)}catch(e){}})),d=e.hooks.useEventCallback((()=>{i.current&&(clearTimeout(i.current),i.current=null),a.current&&c(!1)})),p=e.hooks.useEventCallback(((...e)=>{i.current&&clearTimeout(i.current),c(!0),i.current=setTimeout((()=>{if(i.current=null,l.current)try{s.current(...e)}finally{c(!1)}}),n)})),g=e.React.useRef(null),h=e.hooks.useLatest(p),f=e.hooks.useLatest(d);if(!g.current){const e=(...e)=>{h.current(...e)};e.cancel=()=>f.current(),g.current=e}return e.hooks.useEffectOnce((()=>()=>{l.current=!1,f.current()})),g.current})(Z,500),X=e.hooks.useEventCallback((e=>{R(String(e)),J(String(e))})),K=e.hooks.useEventCallback((()=>{J.cancel();if(Z(N)){const e=parseInt(N,10);T("maxResults",e)}})),ee=g(0,x,T,"enableToggleRemoval"),te=g(0,O,T,"enablePIIMasking"),re=g(0,k,T,"enableBatchOwnerQuery"),oe=e.hooks.useEventCallback((e=>{const t=Math.max(0,Math.min(99,Math.round(e)));P(String(t))})),ne=e.hooks.useEventCallback((()=>{if(q(C)){const e=parseInt(C,10);T("relationshipId",e)}})),ie=e.hooks.useEventCallback((e=>{H(e.target.value)})),ae=e.hooks.useEventCallback((()=>{const e=(0,p.normalizeHostValue)(z);if(!e)return void H("");if(_.includes(e))return;const t=[..._,e];F(t),T("allowedHosts",t),H("")})),le=e.hooks.useEventCallback((e=>{const t=(0,p.normalizeHostValue)(e),r=_.filter((e=>e!==t));r.length!==_.length&&(F(r),T("allowedHosts",r))})),se=e.hooks.useEventCallback((e=>{"Enter"===e.key&&(e.preventDefault(),Ne&&ae())})),ue=e.hooks.useEventCallback((e=>{const t=e||d.PP;Q(t),T("highlightColor",t)})),ce=h(U,W,T,"highlightOpacity",p.opacityHelpers.fromPercent),de=h(B,Y,T,"outlineWidth",p.outlineWidthHelpers.normalize),pe=e.hooks.useEventCallback((e=>{var t,r,o,n,i;const s=null!==(t=null==e?void 0:e[0])&&void 0!==t?t:null,d=null!==(r=null==s?void 0:s.dataSourceId)&&void 0!==r?r:"",p=null!==(i=null===(n=null===(o=a.useDataSources)||void 0===o?void 0:o.find)||void 0===n?void 0:n.call(o,(e=>(null==e?void 0:e.dataSourceId)===l.ownerDataSourceId)))&&void 0!==i?i:null,g=D(p),h=!!d&&!l.ownerDataSourceId||!!d&&l.ownerDataSourceId&&l.ownerDataSourceId===l.propertyDataSourceId,f=[];s&&f.push(s),g&&g.dataSourceId&&g.dataSourceId!==d&&!h&&f.push(g);const y=h?l.set("propertyDataSourceId",d).set("ownerDataSourceId",d):l.set("propertyDataSourceId",d);c({id:u,useDataSources:f,config:y})})),ge=e.hooks.useEventCallback((e=>{var t,r,o,n,i;const s=null!==(t=null==e?void 0:e[0])&&void 0!==t?t:null,d=null!==(r=null==s?void 0:s.dataSourceId)&&void 0!==r?r:"",p=null!==(i=null===(n=null===(o=a.useDataSources)||void 0===o?void 0:o.find)||void 0===n?void 0:n.call(o,(e=>(null==e?void 0:e.dataSourceId)===l.propertyDataSourceId)))&&void 0!==i?i:null;let g=D(p);!g&&l.propertyDataSourceId&&(g={dataSourceId:l.propertyDataSourceId,mainDataSourceId:l.propertyDataSourceId,rootDataSourceId:l.propertyDataSourceId});const h=[];g&&h.push(g),!s||g&&g.dataSourceId===s.dataSourceId||h.push(s);const f=l.set("ownerDataSourceId",d);c({id:u,useDataSources:h,config:f})})),he=e.hooks.useEventCallback((e=>{c({id:u,useMapWidgetIds:e})}));e.hooks.useUpdateEffect((()=>{R(String(l.maxResults||50))}),[l.maxResults]),e.hooks.useUpdateEffect((()=>{x(A("enableToggleRemoval"))}),[l.enableToggleRemoval]),e.hooks.useUpdateEffect((()=>{O(A("enablePIIMasking"))}),[l.enablePIIMasking]),e.hooks.useUpdateEffect((()=>{k(A("enableBatchOwnerQuery",!1))}),[l.enableBatchOwnerQuery]),e.hooks.useUpdateEffect((()=>{var e;P(String(null!==(e=l.relationshipId)&&void 0!==e?e:0))}),[l.relationshipId]),e.hooks.useUpdateEffect((()=>{const e=(0,p.normalizeHostList)(l.allowedHosts);F(e)}),[l.allowedHosts]),e.hooks.useUpdateEffect((()=>{Q(l.highlightColor||d.PP)}),[l.highlightColor]),e.hooks.useUpdateEffect((()=>{const e="number"==typeof l.highlightOpacity?l.highlightOpacity:d.Tq;W(p.opacityHelpers.fromPercent(p.opacityHelpers.toPercent(e)))}),[l.highlightOpacity]),e.hooks.useUpdateEffect((()=>{const e="number"==typeof l.outlineWidth?l.outlineWidth:d.Sh;Y(p.outlineWidthHelpers.normalize(e))}),[l.outlineWidth]),e.hooks.useEffectOnce((()=>{}));const fe=Array.isArray(y)&&y.length>0,ye=Boolean(l.propertyDataSourceId),Ie=Boolean(l.ownerDataSourceId),me=ye&&Ie,we=fe&&me,ve=fe&&me,be=!ve;e.hooks.useEffectWithPreviousValues((()=>{be&&(L&&k(!1),l.enableBatchOwnerQuery&&T("enableBatchOwnerQuery",!1),void 0!==l.relationshipId&&T("relationshipId",void 0),"0"!==C&&P("0"),$((e=>Object.assign(Object.assign({},e),{relationshipId:void 0}))))}),[be,L,l.enableBatchOwnerQuery,l.relationshipId,C,T]);const Se=p.opacityHelpers.toPercent(U),De=p.opacityHelpers.formatPercent(Se),Me=p.outlineWidthHelpers.normalize(B),Ae=p.outlineWidthHelpers.formatDisplay(B),Te=(0,p.normalizeHostValue)(z),Ne=Te.length>0&&!_.includes(Te),Re=M(l.propertyDataSourceId),Ee=M(l.ownerDataSourceId);return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row,label:S("mapWidgetTitle","mapWidgetDescription")},(0,e.jsx)(o.MapWidgetSelector,{onSelect:he,useMapWidgetIds:y}))),(0,e.jsx)(o.SettingSection,null,fe&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row,label:S("propertyDataSourceLabel","propertyDataSourceDescription")},(0,e.jsx)(n.DataSourceSelector,{types:(0,e.Immutable)([e.DataSourceTypes.FeatureLayer]),useDataSources:Re,mustUseDataSource:!0,onChange:pe,widgetId:u,hideTypeDropdown:!0})),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row,label:S("ownerDataSourceLabel","ownerDataSourceDescription")},(0,e.jsx)(n.DataSourceSelector,{types:(0,e.Immutable)([e.DataSourceTypes.FeatureLayer]),useDataSources:Ee,mustUseDataSource:!0,onChange:ge,widgetId:u,hideTypeDropdown:!0})),!me&&(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row},(0,e.jsx)(t.Alert,{css:v.fullWidth,type:"warning",text:m("dataSourcesDescription"),closable:!1})))),we&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:m("panelDisplaySettings"),type:"default",level:1,role:"group","aria-label":m("panelDisplaySettings")},(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row,label:S("maxResultsLabel","maxResultsDescription")},(0,e.jsx)(t.NumericInput,{css:v.fullWidth,value:parseInt(N,10),min:1,max:1e3,onChange:X,onBlur:K,"aria-label":m("maxResultsLabel"),"aria-invalid":!!V.maxResults})),V.maxResults&&(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row},(0,e.jsx)(t.Alert,{css:v.fullWidth,type:"error",text:V.maxResults,closable:!1})),(0,e.jsx)(o.SettingRow,{flow:"no-wrap",level:1,css:v.row,label:S("enableToggleRemovalLabel","enableToggleRemovalDescription")},(0,e.jsx)(t.Switch,{checked:E,onChange:ee,"aria-label":m("enableToggleRemovalLabel")})),(0,e.jsx)(o.SettingRow,{flow:"no-wrap",level:1,css:v.row,label:S("enablePIIMaskingLabel","enablePIIMaskingDescription")},(0,e.jsx)(t.Switch,{checked:j,onChange:te,"aria-label":m("enablePIIMaskingLabel")})),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row,label:S("allowedHostsLabel","allowedHostsDescription")},(0,e.jsx)("div",{css:v.allowedHostInputRow},(0,e.jsx)(t.TextInput,{css:v.allowedHostInput,value:z,onChange:ie,onKeyDown:se,placeholder:m("allowedHostsPlaceholder"),"aria-label":m("allowedHostsLabel"),spellCheck:!1}),(0,e.jsx)(t.Button,{type:"default",icon:!0,onClick:ae,title:m("addAllowedHostLabel"),"aria-label":m("addAllowedHostLabel"),disabled:!Ne,css:v.addAllowedHostButton},(0,e.jsx)(t.SVG,{src:I(),size:16})))),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row},(0,e.jsx)("div",{css:v.allowedHostList},_.length>0?_.map((r=>(0,e.jsx)("div",{css:v.allowedHostListRow,key:r},(0,e.jsx)(t.TextInput,{css:v.allowedHostListInput,value:r,readOnly:!0,borderless:!0,disabled:!0,spellCheck:!1,"aria-label":`${m("allowedHostsListLabel")}: ${r}`}),(0,e.jsx)(t.Button,{type:"tertiary",icon:!0,onClick:()=>le(r),title:m("removeAllowedHostLabel"),"aria-label":m("removeAllowedHostLabel")},(0,e.jsx)(t.SVG,{src:w(),size:16}))))):(0,e.jsx)("div",{css:v.description,role:"status","aria-live":"polite"},m("allowedHostsEmptyHint")))))),(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:m("panelHighlightSettings"),type:"default",level:1,role:"group","aria-label":m("panelHighlightSettings")},(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row,label:S("highlightColorLabel","highlightColorLabelTooltip")},(0,e.jsx)(r.ColorPicker,{css:v.fullWidth,color:G,onChange:ue,"aria-label":m("highlightColorLabel")})),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row,label:S("highlightOpacityLabel","highlightOpacityLabelTooltip")},(0,e.jsx)("div",{css:v.sliderWrap},(0,e.jsx)("div",{css:v.sliderTrack},(0,e.jsx)(t.Slider,{value:Se,min:0,max:100,step:5,tooltip:!0,formatter:p.opacityHelpers.formatPercent,"aria-label":m("highlightOpacityLabel"),onChange:ce,css:v.sliderControl}),(0,e.jsx)("div",{css:v.sliderValue,role:"status","aria-live":"polite"},De)))),(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row,label:S("highlightOutlineWidthLabel","highlightOutlineWidthLabelTooltip")},(0,e.jsx)("div",{css:v.sliderWrap},(0,e.jsx)("div",{css:v.sliderTrack},(0,e.jsx)(t.Slider,{value:Me,min:.5,max:10,step:.5,tooltip:!0,formatter:p.outlineWidthHelpers.formatDisplay,"aria-label":m("highlightOutlineWidthLabel"),onChange:de,css:v.sliderControl}),(0,e.jsx)("div",{css:v.sliderValue,role:"status","aria-live":"polite"},Ae))))))),ve&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(o.SettingSection,null,(0,e.jsx)(t.CollapsablePanel,{label:m("advancedSettingsTitle"),type:"default",level:1,role:"group","aria-label":m("advancedSettingsTitle")},(0,e.jsx)(o.SettingRow,{flow:"no-wrap",level:1,css:v.row,label:S("enableBatchOwnerQueryLabel","enableBatchOwnerQueryDescription")},(0,e.jsx)(t.Switch,{checked:L,onChange:re,"aria-label":m("enableBatchOwnerQueryLabel")})),L&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row,label:S("relationshipIdLabel","relationshipIdDescription")},(0,e.jsx)(t.NumericInput,{css:v.fullWidth,value:parseInt(C,10),min:0,max:99,onChange:oe,onBlur:ne,"aria-label":m("relationshipIdLabel"),title:m("relationshipIdTooltip"),"aria-invalid":!!V.relationshipId})),V.relationshipId&&(0,e.jsx)(o.SettingRow,{flow:"wrap",level:1,css:v.row},(0,e.jsx)(t.Alert,{css:v.fullWidth,type:"error",text:V.relationshipId,closable:!1})))))))};function D(e){u.p=e}})(),c})())}}}));